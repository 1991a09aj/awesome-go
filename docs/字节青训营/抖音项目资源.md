# 整理关于抖音项目的资源


## 链接

----
**直播相关：**

+ [直播文档](https://bytedance.feishu.cn/docx/WZDddh2Lqoyfu6x93u1c8km9nug)
+ [组队](https://bytedance.feishu.cn/sheets/shtcnVBO1GXF5XEvHgUc7YwIaDc)


**抖音项目相关：**
+ [抖音项目Windows下调试环境搭建|青训营笔记 - 掘金](https://juejin.cn/post/7096857967747661831)
+ [Go语言开发实战](https://time.geekbang.org/column/intro/100079601?tab=catalog)
+ [短视频平台开发，首先要搭建短视频框架](https://zhuanlan.zhihu.com/p/387179317)
+ [荏苒项目：Feed流系统（简介与tablestore简单操作）_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1tz4y1Q7D2?p=1&share_medium=iphone&share_plat=ios&share_session_id=B07E9067-AB78-4668-8873-55100E4F859C&share_source=WEIXIN&share_tag=s_i&timestamp=1651985422&unique_k=P6DgwIw)
+ [会议文档 2023年1月12日](https://m8x44j2c67.feishu.cn/docx/KyDAdCCGgolLYAxYbLMcjBefn5f)
+ [poc](https://github.com/joaomarcuslf/grpc-golang-example)
+ [抖音项目背景介绍](https://bytedance.feishu.cn/docs/doccnKrCsU5Iac6eftnFBdsXTof#)
+ 各功能对应的接口说明文档，地址 https://www.apifox.cn/apidoc/shared-09d88f32-0b6c-4157-9d07-a36d32d7a75c 。
+  极简抖音 APP 包使用说明：​ [极简抖音 App 使用说明 - 青训营版​ 。​ ](https://bytedance.feishu.cn/docs/doccnM9KkBAdyDhg8qaeGlIz7S7)
+ 服务端 Demo，仓库地址 https://github.com/RaymondCode/simple-demo 。
+ [抖音内部课](https://juejin.cn/course/bytetech) 
+ [抖音的完整设计和文档稿](https://github.com/HammerCloth/tiktok)
+ [抖音项目在window下的调试](https://juejin.cn/post/7096857967747661831)
+ [ADDD_抖音文档](https://vfchdrh6q6.feishu.cn/docx/doxcnwTuJ3CbOFDhQan4EQBrKWg) 
+ [项目文档](https://vfchdrh6q6.feishu.cn/docx/doxcnwTuJ3CbOFDhQan4EQBrKWg)   [https://github.com/ACking-you/byte_douyin_project](https://github.com/ACking-you/byte_douyin_project)
+ [抖音项目](https://github.com/a76yyyy/tiktok)
+ [使用了Kubernetes的tiktok](https://github.com/tik-listen/tiktok)



## 设计稿

+ [x] [用户注册接口设计](https://rll0wlkrr7.feishu.cn/docx/HPLidzk8EooQyWxsBmGcN6vNneh)
+ [x] [互动接口 - 点赞操作](https://tkz5v5lygv.feishu.cn/docx/EFkudxjWRoD7UMx5XLyc6ASrn5e)
+ [x] [视频流接口设计](https://hardcore.feishu.cn/docx/PLXtdM1tkoXCK2xH0oIctWAOnLc)
+ [x] [用户登陆接口设计](https://m8x44j2c67.feishu.cn/docx/XOcAd43dqolCS2xR8Kec2UzYnfb)
+ [x] 用户信息接口
+ [ ] 视频投稿接口
+ [ ] 发布列表接口
+ [x] 评论接口
+ [ ] 社交接口
+ [ ] 用户关注列表
+ [ ] 用户粉丝列表
+ [ ] 用户友好列表





----

### 模块设计

#### 视频模块的设计

视频模块包括视频Feed流获取、视频投稿和获取用户投稿列表。 详情请阅读[视频模块设计说明](https://bytedancecampus1.feishu.cn/docs/doccntmcunjHSMzVUNEhGbxjxJh) 查阅为该模块的详细设计。

#### 点赞模块的设计

点赞模块包括点赞视频、取消赞视频和获取点赞列表。 详情请阅读[点赞模块设计说明](https://bytedancecampus1.feishu.cn/docs/doccn13iJgTIAebIPpMiRqb0Hwb) 查阅为该模块的详细设计。

#### 关注模块的设计

关注模块包括关注、取关、获取关注列表、获取粉丝列表四个基本功能。 详情请阅读[关注模块的设计说明](https://bytedancecampus1.feishu.cn/docs/doccnOsdm29SufPJkDfRs7tLHgx) 查阅为该模块的详细设计。

#### 用户模块的设计

用户与安全模块包括用户注册、用户登录和用户信息三个部分 详情请阅读[用户模块的设计说明](https://bytedancecampus1.feishu.cn/docs/doccn1vusmV9oN1ukTCyLpbJ46f) 查阅为该模块的详细设计。

#### 评论模块的设计

评论模块包括发表评论、删除评论和查看评论。 详情阅读[评论模块的设计说明](https://bytedancecampus1.feishu.cn/docs/doccnDqfcZJW4tTD409NGlYfvCb) 查阅为该模块的详细设计。



## 第三届

**Feed 流**：

>  不间断的提供视频流服务，集**推荐算法** + **存储分发** 于一体的服务，不停地推



**谁在拉？后端服务该推向谁？**

> APP



**推荐算法，数据从哪来？**

> ClickHouse + BI 工具去做一个推荐



### 存储分发怎么做

**一种需求，两个方向：** 推，和拉

+ 在 Web 方向上的【推】：去数据库，主动查找
+ 在 Web 方向上【拉】：存数据库，交给数据库操作

【关注UP主的视频列表】和【我的粉丝列表】

**⚠️ IO效率 是重点**



### 怎么通知 粉丝 关注的 UP 主的视频列表

在存储方向上【推】：UP 主有一个粉丝列表，粉丝每次读取的时候，不是从 UP 那边来的，而是从自己的视频池子里拿的，UP 每一次更新，都有会视频大量写入大量粉丝的视频池，**读写IO比 = 1 : 99**

在存储方向上【拉】： UP主仍然有个粉丝列表，但是，每一次新视频的推出，仅仅只会通知粉丝们去拉取视频到自己的视频池子里。读写IO比是：99 : 1

暂时业界内还没方法平衡 99 和 1，目前业界解决方案是 更新 自己的数据库

视频有先后，所有，为了表达先后，MySQL 使用 上锁 + 自增ID ，每一次读写，都有可能碰到上锁，数量大了，分库分表怎么办？（粉丝列表和关注列表）视频评论总该存吧？

非关系型 + 表格存储 偏向 无结构 -> MySQL （用户隐私信息）+ Mongo（大量视频相关的元数据）+ Redis （视频相关热点视频，热门视频下的点赞信息，用户方面 JWT Token 授权信息） + 文件服务器（视频本身） -> 对象存储服务

> 元数据：文件系统内鼠标右键能看到的【属性】，便是一种元数据
>
> 认证和授权（鉴权）：两种不一样的服务，认证在于第一次的使用，包括第一次登录，主要传递 账户 和 摘要算法 Hash 后的 密码；授权，在于认证的后续使用，便捷地去做判断，
>
> JWT Token：认证方式之一，简单理解为，一个 string 走天下。



### 核心解决

+ 存储

+ MySQL 表如何设计更加合理

+ MongoDB （如果使用的话）表内结构怎么去设计

+ 安全性（什么时候什么安全算法）

  + 视频认证、去重 : MD5
  + 密码等敏感信息（性能不敏感情况下）：SHA-512

+ 性能

+ 测试工具和方案

  + Go语言原生自带

  + python压力测试工具

  + 单测：看代码涉及到的功能粗细程度

    > 比如，有功能根据操作系统的信息去做服务，单独写一个单测文件完全不够，最好是通过 Jenkins 去做不同操作系统环境下的 系统测试
    >
    > Go  html/template 解析一个文件服务，生成 XXX_test.go 做单测，就已经足够了



## 接到需求应该干那些事pdf

![[接到需求任务该做哪些事.pdf]]

### 需求前准备

第一个版本之前的所有技术栈应用的多个 POC （2023年1月12日 ~ 19 日）

先不分需求，不要求覆盖率，对某个 API 感兴趣，就做一个后端的 POC，内容包括：

+ 数据库设计（只针对那一个请求）
+ 代码（只响应那一个请求）
+ 测试时麻烦构造必须的周边的数据结构、测试用例
+ **发出自己的 POC 方案到飞书群里（2023年1月13日 开始）（可以对 POC 方案进行询问）**



### 框架技术

> Web 框架、RPC框架、

1. 熟练技术栈的同时，对项目不影响
2. 写 demo、测试用例
3. 评估自己在编码态度**极度随便**的情况下，需要多少成本（时间，精力），才能做完所有的 API 请求响应（这些 POC 也可以当做第一个版本提交，第一个版本更多的是对 POC 的优化、缝合）
4. 包括认证、授权的种种框架



### 第一版本目标

> 实现完所有的 API
>
> （等所有 API 的 POC 都覆盖到了就开始，2月份之前做完）

工期预计：（大家讨论，一周起底）

效果：

1. 能完成响应所有【视频流】正常场景下的 API 请求（异常场景先不考虑，在不影响效率的情况下可以做）
2. 细粒度代码都有单测（都能通过），粗粒度功能在每次提交到 Main 分支时，对 main 分支部署没有负面影响
3. 对于测试集成方面，形成一套**工具流**，能做到【自动 fetch  开发分支更新，并及时调用资源进行完整测试，信息能通过邮件发送】（工期预计 7 天）



### CI流

1. 大家的 CI 服务器去 拿源码 自行测（定时？推送链接？）
2. 测试结果，通过邮件发送





## 基本架构

![image-20230117135507489](http://sm.nsddd.top/sm202301171355646.png)

![img_v2_3db35449-e95e-477d-a9a4-0def786ff20g.jpg](http://sm.nsddd.top/sm202301131326951.png)

![img_v2_e48fbcd6-eaa3-4931-893d-3eee7060244g.jpg](http://sm.nsddd.top/sm202301131327021.png)
![img_v2_60241047-8fe7-42da-910c-2f67c5732a3g.jpg](http://sm.nsddd.top/sm202301131327106.png)



单体应用，分模块

八人，分 API 做，涉及联调，自行处理

第一次 和 第二次提交。针对整体目录结构、目录结构说明文档、大家分析的需求背后所需要的模块的目录结构 



## 代码仓库，项目管理

GitHub + 看板（进度） + Issue（需求）+ 组权限 + GitHub 上限制对 main 操作（禁 push -f ），不提 Pr 合并，功能写完了，dev  merge main ，冲突解决请找到参与文件冲突的开发者（在群里面问一句，说一声）



## 抖音推送机制

抖音一共有至少不少于三个递进式的流量池第一个流量池，针对自己的粉丝或者同城抖友，平台将审核通过的视频率先推给你的 500 个粉丝，并且是活跃粉丝，如果存在很久不登陆的粉丝，那么会用和你粉丝相似的人来代替在这一个环节，一般都是机审，机器会为你的视频打分，从整体的画质、时长、剪辑等等给你视频一个最初步的打分，这个环节会由评分来决定你是否能获得足额的 500 播放量。

第二个流量池，针对第一波推送后给你视频良好反馈的粉丝的相近人群。用通俗易懂的话来说，就是第一波的 500 人，比如说有 10 人看完了你的视频，3 个人给你点赞，1 个人给你评论，那么这 14 个人就是给你视频带来良好反馈的人，所以第二个流量池就会推送给类似这 14 个人的人群，他们有着很接近的兴趣，愿意在某一类视频上停留，也愿意点赞和转发某一类视频。第二个流量池的人数上限可以到 10W 播放，但是仍然会有机审，并且有人工审核抽查。如果发现有违规或者举报人数过多，仍然会停止推送、删除视频或者封号。第三个流量池，针对的就不再是仅仅对你视频感兴趣的或者和你粉丝接近的人群了，这也就是说为什么抖音不是一个标准意义的“千人千面”的 ugc 了。在这个流量池，你的视频可以达到百万播放，但是面临的就是“大众评审”了。




## feed 流

feed 流是持续更新并呈现给用户内容的信息流，feed 是将用户主动订阅的若干消息源组合在一起形成内容聚合器，帮助用户持续地获取最新的订阅源内容



## 抖音内部架构分析

**抖音是一款短视频分享应用，它的架构可能包括以下部分:**

1.  前端: 使用 React Native 或 Flutter 构建的移动端应用
2.  后端: 使用 Java 或 Go 等语言构建的 RESTful API 和数据存储
3.  数据库: 使用 MySQL 或 MongoDB 等数据库管理系统
4.  服务器: 可能使用了大量的服务器来承载网站和应用的流量
5.  云服务: 可能使用了云服务提供商（如 Amazon Web Services 或 Google Cloud Platform）来扩展应用的可用性和性能

**抖音后端架构可能包括以下部分:**

1.  网关层: 负责处理请求路由和鉴权，保证安全性和可靠性。
2.  服务层: 负责实际的业务逻辑，如视频上传、播放、评论等。
3.  数据层: 负责存储和管理数据，如用户信息、视频信息等。可能使用 MySQL，MongoDB，Redis等数据库。
4.  缓存层: 负责提高系统性能和减少对数据库的压力，使用缓存技术如Memcached或Redis等
5.  消息队列层: 负责异步处理耗时任务，如视频转码、推送等。可能使用RabbitMQ或Kafka等。
6.  监控层: 负责监控系统的各项指标，如响应时间、错误率等，使用工具如 Prometheus 或 Zabbix 等。
7.  分布式系统: 使用分布式系统来处理大量的并发请求和海量的数据，可能使用 Kubernetes 等工具管理
8.  微服务架构: 使用微服务架构将大型系统拆分成多个小型服务，来提高系统可维护性和可扩展性。
9.  容错和高可用性: 使用容错技术和高可用性技术来保证系统可用性和可靠性。例如使用Hystrix来防止服务雪崩，使用Zookeeper来管理服务注册和发现等。
10.  数据分析和挖掘: 使用数据分析和挖掘技术来收集、分析和挖掘用户数据，以改善用户体验和提高营销效果。


**数据库的范畴：**

1.  MySQL: 一种关系型数据库管理系统，可能用来存储用户信息、视频信息等。
2.  MongoDB: 一种非关系型数据库管理系统，可能用来存储高速查询和读写的数据，如用户评论和点赞信息。
3.  Redis: 一种内存数据库管理系统，可能用来存储缓存数据，提高系统性能和减少对数据库的压力。
4.  Cassandra: 一种分布式数据库管理系统，可能用来存储海量的历史数据，如视频流量和点赞数据。
5.  Elasticsearch: 一种全文检索和分析数据库管理系统，可能用来存储和检索文本数据，如视频标题和评论。

