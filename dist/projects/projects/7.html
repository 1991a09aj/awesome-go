<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/img/1.jpg"><title>第7节 高质量的Makefile | 你好</title><meta name="description" content="链学社致力于打造出区块链去中心化的学习平台">
    <link rel="modulepreload" href="/assets/app.bdc458db.js"><link rel="modulepreload" href="/assets/7.html.56549c18.js"><link rel="modulepreload" href="/assets/7.html.9fc2c34a.js"><link rel="prefetch" href="/assets/index.html.fe0570d7.js"><link rel="prefetch" href="/assets/index.html.799f99d1.js"><link rel="prefetch" href="/assets/go_route.html.c8fe622e.js"><link rel="prefetch" href="/assets/index.html.ebe30265.js"><link rel="prefetch" href="/assets/index.html.b2a5a271.js"><link rel="prefetch" href="/assets/bitwise.html.0875bf7a.js"><link rel="prefetch" href="/assets/catalogue.html.d45d2ea3.js"><link rel="prefetch" href="/assets/go-air.html.50ef7c1a.js"><link rel="prefetch" href="/assets/go-version.html.f82697a0.js"><link rel="prefetch" href="/assets/go_file.html.e6caea41.js"><link rel="prefetch" href="/assets/go_mod.html.2b3ea260.js"><link rel="prefetch" href="/assets/mod.html.bac87341.js"><link rel="prefetch" href="/assets/name.html.bcc8fde0.js"><link rel="prefetch" href="/assets/index.html.37f33959.js"><link rel="prefetch" href="/assets/zhenze.html.28cf92c0.js"><link rel="prefetch" href="/assets/index.html.596f6da4.js"><link rel="prefetch" href="/assets/1.html.36144ee3.js"><link rel="prefetch" href="/assets/10.html.da722ebe.js"><link rel="prefetch" href="/assets/11.html.31e40108.js"><link rel="prefetch" href="/assets/12.html.0898ecc7.js"><link rel="prefetch" href="/assets/13.html.0a65d5eb.js"><link rel="prefetch" href="/assets/14.html.be4956cc.js"><link rel="prefetch" href="/assets/15.html.a8adeffa.js"><link rel="prefetch" href="/assets/16.html.f18704c3.js"><link rel="prefetch" href="/assets/17.html.783339a3.js"><link rel="prefetch" href="/assets/18.html.923df3cc.js"><link rel="prefetch" href="/assets/19.html.9a6796eb.js"><link rel="prefetch" href="/assets/2.html.ace4d0cd.js"><link rel="prefetch" href="/assets/20.html.f7001dd2.js"><link rel="prefetch" href="/assets/21.html.8748d4cc.js"><link rel="prefetch" href="/assets/22.html.bf197532.js"><link rel="prefetch" href="/assets/23.html.e46aa786.js"><link rel="prefetch" href="/assets/24.html.1bc12ccb.js"><link rel="prefetch" href="/assets/25.html.9da66186.js"><link rel="prefetch" href="/assets/26.html.536b3d1b.js"><link rel="prefetch" href="/assets/27.html.4c596bfd.js"><link rel="prefetch" href="/assets/28.html.5c0110cc.js"><link rel="prefetch" href="/assets/29.html.25de6c78.js"><link rel="prefetch" href="/assets/3.html.d9dde611.js"><link rel="prefetch" href="/assets/30.html.a61a9f96.js"><link rel="prefetch" href="/assets/4.html.e2a114cd.js"><link rel="prefetch" href="/assets/5.html.8de69897.js"><link rel="prefetch" href="/assets/6.html.075b7fd1.js"><link rel="prefetch" href="/assets/7.html.259b8049.js"><link rel="prefetch" href="/assets/8.html.5038041b.js"><link rel="prefetch" href="/assets/9.html.ab5a6ab3.js"><link rel="prefetch" href="/assets/chan底层分析.html.aa95a27f.js"><link rel="prefetch" href="/assets/eth.html.752bbd67.js"><link rel="prefetch" href="/assets/file.html.5fbdaf59.js"><link rel="prefetch" href="/assets/gofloat.html.b2f73e3e.js"><link rel="prefetch" href="/assets/Go汇编.html.2eee7fc6.js"><link rel="prefetch" href="/assets/九型人格.html.81266ddb.js"><link rel="prefetch" href="/assets/反射.html.1fd002bd.js"><link rel="prefetch" href="/assets/并发.html.7135a824.js"><link rel="prefetch" href="/assets/字节青训营进阶面试准备.html.54660659.js"><link rel="prefetch" href="/assets/接口设计稿.html.145ed7d2.js"><link rel="prefetch" href="/assets/码上掘金主题创作活动.html.59816292.js"><link rel="prefetch" href="/assets/青训营题库.html.2024f8c3.js"><link rel="prefetch" href="/assets/index.html.5926a271.js"><link rel="prefetch" href="/assets/CONTRIBUTING.html.676d7862.js"><link rel="prefetch" href="/assets/index.html.d1216937.js"><link rel="prefetch" href="/assets/index.html.79059640.js"><link rel="prefetch" href="/assets/1.html.235cc506.js"><link rel="prefetch" href="/assets/10.html.5c312915.js"><link rel="prefetch" href="/assets/11.html.55699fcd.js"><link rel="prefetch" href="/assets/12.html.a382bc79.js"><link rel="prefetch" href="/assets/13.html.aa855ae8.js"><link rel="prefetch" href="/assets/14.html.08ef65bd.js"><link rel="prefetch" href="/assets/15.html.01d21e16.js"><link rel="prefetch" href="/assets/16.html.70b426a8.js"><link rel="prefetch" href="/assets/17.html.f1499142.js"><link rel="prefetch" href="/assets/18.html.d8d3da03.js"><link rel="prefetch" href="/assets/19.html.015fd28a.js"><link rel="prefetch" href="/assets/2.html.769b639f.js"><link rel="prefetch" href="/assets/20.html.f9c50793.js"><link rel="prefetch" href="/assets/21.html.e90aecab.js"><link rel="prefetch" href="/assets/22.html.b8dd466e.js"><link rel="prefetch" href="/assets/23.html.adc860f9.js"><link rel="prefetch" href="/assets/24.html.d252c2b7.js"><link rel="prefetch" href="/assets/25.html.bee06ed0.js"><link rel="prefetch" href="/assets/26.html.b9dec8d9.js"><link rel="prefetch" href="/assets/27.html.4db64b27.js"><link rel="prefetch" href="/assets/28.html.22e1efc5.js"><link rel="prefetch" href="/assets/29.html.48a9f807.js"><link rel="prefetch" href="/assets/3.html.6776d83a.js"><link rel="prefetch" href="/assets/30.html.b6adc27b.js"><link rel="prefetch" href="/assets/31.html.58cd209d.js"><link rel="prefetch" href="/assets/32.html.dd04e440.js"><link rel="prefetch" href="/assets/33.html.10090b2d.js"><link rel="prefetch" href="/assets/34.html.3636fe56.js"><link rel="prefetch" href="/assets/35.html.d4c55782.js"><link rel="prefetch" href="/assets/36.html.2866b6e8.js"><link rel="prefetch" href="/assets/37.html.a165ac3b.js"><link rel="prefetch" href="/assets/38.html.7970a5ca.js"><link rel="prefetch" href="/assets/39.html.25a2a187.js"><link rel="prefetch" href="/assets/4.html.3296e70a.js"><link rel="prefetch" href="/assets/40.html.9c879ac6.js"><link rel="prefetch" href="/assets/41.html.bf6a470e.js"><link rel="prefetch" href="/assets/42.html.7dd22ad5.js"><link rel="prefetch" href="/assets/43.html.68ab423b.js"><link rel="prefetch" href="/assets/44.html.78d0b9cb.js"><link rel="prefetch" href="/assets/45.html.6c351189.js"><link rel="prefetch" href="/assets/46.html.ede9ae29.js"><link rel="prefetch" href="/assets/47.html.0af69310.js"><link rel="prefetch" href="/assets/48.html.0a007480.js"><link rel="prefetch" href="/assets/49.html.ff9fd03c.js"><link rel="prefetch" href="/assets/5.html.58f5b1b7.js"><link rel="prefetch" href="/assets/50.html.c9b82bd5.js"><link rel="prefetch" href="/assets/51.html.26521767.js"><link rel="prefetch" href="/assets/52.html.c7e1e0b4.js"><link rel="prefetch" href="/assets/53.html.b26e3e4d.js"><link rel="prefetch" href="/assets/54.html.0f43b492.js"><link rel="prefetch" href="/assets/55.html.4e499377.js"><link rel="prefetch" href="/assets/56.html.6717ae50.js"><link rel="prefetch" href="/assets/57.html.e0493603.js"><link rel="prefetch" href="/assets/58.html.7b43713c.js"><link rel="prefetch" href="/assets/59.html.2240bf2a.js"><link rel="prefetch" href="/assets/6.html.c77757ad.js"><link rel="prefetch" href="/assets/60.html.04a1b1a2.js"><link rel="prefetch" href="/assets/61.html.0180164d.js"><link rel="prefetch" href="/assets/62.html.5aa383df.js"><link rel="prefetch" href="/assets/63.html.4eafb66f.js"><link rel="prefetch" href="/assets/64.html.7d2e947e.js"><link rel="prefetch" href="/assets/65.html.f91d4ee9.js"><link rel="prefetch" href="/assets/66.html.4b576058.js"><link rel="prefetch" href="/assets/67.html.2dd3fcab.js"><link rel="prefetch" href="/assets/68.html.aa224bc8.js"><link rel="prefetch" href="/assets/69.html.dcdfe4e4.js"><link rel="prefetch" href="/assets/7.html.d22b99dc.js"><link rel="prefetch" href="/assets/70.html.88ad98ba.js"><link rel="prefetch" href="/assets/71.html.35cc51da.js"><link rel="prefetch" href="/assets/72.html.e0c43705.js"><link rel="prefetch" href="/assets/73.html.f359483a.js"><link rel="prefetch" href="/assets/74.html.bec94dd1.js"><link rel="prefetch" href="/assets/75.html.9fff4689.js"><link rel="prefetch" href="/assets/76.html.6c07ed9d.js"><link rel="prefetch" href="/assets/77.html.0912a5b9.js"><link rel="prefetch" href="/assets/78.html.7a3c2e6a.js"><link rel="prefetch" href="/assets/79.html.8abf884d.js"><link rel="prefetch" href="/assets/8.html.12a6b159.js"><link rel="prefetch" href="/assets/80.html.6030053a.js"><link rel="prefetch" href="/assets/81.html.17419a40.js"><link rel="prefetch" href="/assets/82.html.9b77dbf0.js"><link rel="prefetch" href="/assets/83.html.73c332e8.js"><link rel="prefetch" href="/assets/84.html.ce5609ce.js"><link rel="prefetch" href="/assets/85.html.beb25b29.js"><link rel="prefetch" href="/assets/86.html.817c788b.js"><link rel="prefetch" href="/assets/87.html.9380d03b.js"><link rel="prefetch" href="/assets/88.html.3eb0a65b.js"><link rel="prefetch" href="/assets/89.html.cc3a0d82.js"><link rel="prefetch" href="/assets/9.html.c6efbd9d.js"><link rel="prefetch" href="/assets/90.html.3535f0b3.js"><link rel="prefetch" href="/assets/91.html.7c473580.js"><link rel="prefetch" href="/assets/92.html.a4919e55.js"><link rel="prefetch" href="/assets/93.html.c4746f39.js"><link rel="prefetch" href="/assets/94.html.eead2a63.js"><link rel="prefetch" href="/assets/95.html.d4e5fabd.js"><link rel="prefetch" href="/assets/96.html.97af7ef2.js"><link rel="prefetch" href="/assets/97.html.0ace7f77.js"><link rel="prefetch" href="/assets/98.html.3045492d.js"><link rel="prefetch" href="/assets/99.html.e1b6ca02.js"><link rel="prefetch" href="/assets/1.html.0e306242.js"><link rel="prefetch" href="/assets/10.html.16e21422.js"><link rel="prefetch" href="/assets/11.html.8f7df031.js"><link rel="prefetch" href="/assets/12.html.2047a9a4.js"><link rel="prefetch" href="/assets/13.html.0feabf60.js"><link rel="prefetch" href="/assets/14.html.5d2145ca.js"><link rel="prefetch" href="/assets/15.html.2a6d842a.js"><link rel="prefetch" href="/assets/16.html.15f61a51.js"><link rel="prefetch" href="/assets/17.html.99c0af78.js"><link rel="prefetch" href="/assets/18.html.c116a903.js"><link rel="prefetch" href="/assets/19.html.64c34358.js"><link rel="prefetch" href="/assets/2.html.404c4df8.js"><link rel="prefetch" href="/assets/20.html.e51c49a9.js"><link rel="prefetch" href="/assets/21.html.72850f1c.js"><link rel="prefetch" href="/assets/22.html.8a2421e1.js"><link rel="prefetch" href="/assets/23.html.a8068a1d.js"><link rel="prefetch" href="/assets/24.html.ed4ef892.js"><link rel="prefetch" href="/assets/25.html.85244a6e.js"><link rel="prefetch" href="/assets/26.html.a530ece1.js"><link rel="prefetch" href="/assets/27.html.2b58dc38.js"><link rel="prefetch" href="/assets/28.html.568c5c59.js"><link rel="prefetch" href="/assets/29.html.baf58f32.js"><link rel="prefetch" href="/assets/3.html.58b79ab7.js"><link rel="prefetch" href="/assets/30.html.29d3065d.js"><link rel="prefetch" href="/assets/31.html.5a5774a9.js"><link rel="prefetch" href="/assets/32.html.3e68319a.js"><link rel="prefetch" href="/assets/33.html.d6192f5b.js"><link rel="prefetch" href="/assets/34.html.28fe4ed8.js"><link rel="prefetch" href="/assets/35.html.d42e0033.js"><link rel="prefetch" href="/assets/36.html.9df4fdac.js"><link rel="prefetch" href="/assets/37.html.31406d3f.js"><link rel="prefetch" href="/assets/38.html.3905cb18.js"><link rel="prefetch" href="/assets/39.html.1ecdea32.js"><link rel="prefetch" href="/assets/4.html.4c070bae.js"><link rel="prefetch" href="/assets/40.html.05dd2b0d.js"><link rel="prefetch" href="/assets/41.html.eb6fd531.js"><link rel="prefetch" href="/assets/42.html.87a96b3c.js"><link rel="prefetch" href="/assets/43.html.6e1125b1.js"><link rel="prefetch" href="/assets/44.html.baffa155.js"><link rel="prefetch" href="/assets/45.html.1cd195b7.js"><link rel="prefetch" href="/assets/46.html.19985086.js"><link rel="prefetch" href="/assets/47.html.4780b7a6.js"><link rel="prefetch" href="/assets/48.html.fe514bf3.js"><link rel="prefetch" href="/assets/49.html.cdf9db74.js"><link rel="prefetch" href="/assets/5.html.2ac6f4f2.js"><link rel="prefetch" href="/assets/50.html.6eef00b3.js"><link rel="prefetch" href="/assets/6.html.67971fc9.js"><link rel="prefetch" href="/assets/7.html.f49614f2.js"><link rel="prefetch" href="/assets/8.html.3535abc2.js"><link rel="prefetch" href="/assets/9.html.68ac8e3b.js"><link rel="prefetch" href="/assets/1.html.8a4563a7.js"><link rel="prefetch" href="/assets/10.html.ad3ee00b.js"><link rel="prefetch" href="/assets/11.html.2755b813.js"><link rel="prefetch" href="/assets/12.html.623368f6.js"><link rel="prefetch" href="/assets/13.html.3f3fe897.js"><link rel="prefetch" href="/assets/14.html.872ad030.js"><link rel="prefetch" href="/assets/15.html.3bb3e15f.js"><link rel="prefetch" href="/assets/16.html.238bd494.js"><link rel="prefetch" href="/assets/17.html.2f689b1b.js"><link rel="prefetch" href="/assets/18.html.defd96a2.js"><link rel="prefetch" href="/assets/19.html.cb27157b.js"><link rel="prefetch" href="/assets/2.html.e705d67a.js"><link rel="prefetch" href="/assets/20.html.d6b702a1.js"><link rel="prefetch" href="/assets/21.html.81ebf320.js"><link rel="prefetch" href="/assets/22.html.3d560814.js"><link rel="prefetch" href="/assets/23.html.1755c245.js"><link rel="prefetch" href="/assets/24.html.ea315686.js"><link rel="prefetch" href="/assets/25.html.39a12d99.js"><link rel="prefetch" href="/assets/26.html.305a68bc.js"><link rel="prefetch" href="/assets/27.html.f08b7220.js"><link rel="prefetch" href="/assets/28.html.58c64f29.js"><link rel="prefetch" href="/assets/29.html.f342fa6a.js"><link rel="prefetch" href="/assets/3.html.6b94edd9.js"><link rel="prefetch" href="/assets/30.html.e119308b.js"><link rel="prefetch" href="/assets/31.html.26612d8c.js"><link rel="prefetch" href="/assets/32.html.096bcc84.js"><link rel="prefetch" href="/assets/33.html.bf171d3b.js"><link rel="prefetch" href="/assets/34.html.36168f64.js"><link rel="prefetch" href="/assets/35.html.1422c1b6.js"><link rel="prefetch" href="/assets/36.html.0aa7f0a2.js"><link rel="prefetch" href="/assets/37.html.f6a229f8.js"><link rel="prefetch" href="/assets/38.html.617c2a41.js"><link rel="prefetch" href="/assets/39.html.ceff315d.js"><link rel="prefetch" href="/assets/4.html.d28e66e5.js"><link rel="prefetch" href="/assets/40.html.f65d98c3.js"><link rel="prefetch" href="/assets/41.html.60450e0e.js"><link rel="prefetch" href="/assets/42.html.2d9280ae.js"><link rel="prefetch" href="/assets/43.html.f696f4d5.js"><link rel="prefetch" href="/assets/44.html.23b37290.js"><link rel="prefetch" href="/assets/45.html.066b87c8.js"><link rel="prefetch" href="/assets/46.html.dd5a20a1.js"><link rel="prefetch" href="/assets/47.html.3740a19b.js"><link rel="prefetch" href="/assets/48.html.a48ac8f8.js"><link rel="prefetch" href="/assets/49.html.3f1adbed.js"><link rel="prefetch" href="/assets/5.html.f163e78b.js"><link rel="prefetch" href="/assets/6.html.7e27aacf.js"><link rel="prefetch" href="/assets/7.html.5ef812a8.js"><link rel="prefetch" href="/assets/8.html.3a4a891b.js"><link rel="prefetch" href="/assets/9.html.ca89a28d.js"><link rel="prefetch" href="/assets/1.html.a3dc020c.js"><link rel="prefetch" href="/assets/10.html.bd14a3fb.js"><link rel="prefetch" href="/assets/100.html.f3db826f.js"><link rel="prefetch" href="/assets/11.html.66433e47.js"><link rel="prefetch" href="/assets/12.html.002d260c.js"><link rel="prefetch" href="/assets/13.html.59e20d79.js"><link rel="prefetch" href="/assets/14.html.73cfcd2c.js"><link rel="prefetch" href="/assets/15.html.99d15b40.js"><link rel="prefetch" href="/assets/16.html.c62c1434.js"><link rel="prefetch" href="/assets/17.html.0075c852.js"><link rel="prefetch" href="/assets/18.html.9538db0b.js"><link rel="prefetch" href="/assets/19.html.96e7efa0.js"><link rel="prefetch" href="/assets/2.html.a4c595c8.js"><link rel="prefetch" href="/assets/20.html.626333f9.js"><link rel="prefetch" href="/assets/21.html.6c94316b.js"><link rel="prefetch" href="/assets/22.html.9d4a851c.js"><link rel="prefetch" href="/assets/23.html.d8b33e76.js"><link rel="prefetch" href="/assets/24.html.7c1a964f.js"><link rel="prefetch" href="/assets/25.html.36d57c56.js"><link rel="prefetch" href="/assets/26.html.a4ccf683.js"><link rel="prefetch" href="/assets/27.html.1fc8c78b.js"><link rel="prefetch" href="/assets/28.html.230f24f9.js"><link rel="prefetch" href="/assets/29.html.cfb655b4.js"><link rel="prefetch" href="/assets/3.html.90f216e6.js"><link rel="prefetch" href="/assets/30.html.e8eb780c.js"><link rel="prefetch" href="/assets/31.html.f16d7bdd.js"><link rel="prefetch" href="/assets/32.html.969db2c6.js"><link rel="prefetch" href="/assets/33.html.2fd1e893.js"><link rel="prefetch" href="/assets/34.html.80f95318.js"><link rel="prefetch" href="/assets/35.html.93bd1a64.js"><link rel="prefetch" href="/assets/36.html.b0d70eb7.js"><link rel="prefetch" href="/assets/37.html.a8634caf.js"><link rel="prefetch" href="/assets/38.html.6d7ee270.js"><link rel="prefetch" href="/assets/39.html.4efa7896.js"><link rel="prefetch" href="/assets/4.html.d361cc4b.js"><link rel="prefetch" href="/assets/40.html.4ee391b3.js"><link rel="prefetch" href="/assets/41.html.2053a7e0.js"><link rel="prefetch" href="/assets/42.html.cc4b36a7.js"><link rel="prefetch" href="/assets/43.html.0f7beb77.js"><link rel="prefetch" href="/assets/44.html.113f35e8.js"><link rel="prefetch" href="/assets/45.html.2fcc7089.js"><link rel="prefetch" href="/assets/46.html.9a29d782.js"><link rel="prefetch" href="/assets/47.html.7fb14238.js"><link rel="prefetch" href="/assets/48.html.62bc0e52.js"><link rel="prefetch" href="/assets/49.html.3975bb80.js"><link rel="prefetch" href="/assets/5.html.6604ccf7.js"><link rel="prefetch" href="/assets/50.html.4077aa53.js"><link rel="prefetch" href="/assets/51.html.f7a84853.js"><link rel="prefetch" href="/assets/52.html.b86a43ba.js"><link rel="prefetch" href="/assets/53.html.769b0acd.js"><link rel="prefetch" href="/assets/54.html.efb643ec.js"><link rel="prefetch" href="/assets/55.html.be95d2bb.js"><link rel="prefetch" href="/assets/56.html.ca415217.js"><link rel="prefetch" href="/assets/57.html.6348bd02.js"><link rel="prefetch" href="/assets/58.html.93afeaf2.js"><link rel="prefetch" href="/assets/59.html.b52e6cc8.js"><link rel="prefetch" href="/assets/6.html.26081d20.js"><link rel="prefetch" href="/assets/60.html.246214a5.js"><link rel="prefetch" href="/assets/61.html.25657f9a.js"><link rel="prefetch" href="/assets/62.html.5b1f07f4.js"><link rel="prefetch" href="/assets/63.html.2dbbd4ac.js"><link rel="prefetch" href="/assets/64.html.0f7da8a1.js"><link rel="prefetch" href="/assets/65.html.1b86b0ed.js"><link rel="prefetch" href="/assets/66.html.d6a1a532.js"><link rel="prefetch" href="/assets/67.html.f777f920.js"><link rel="prefetch" href="/assets/68.html.2f2b75c8.js"><link rel="prefetch" href="/assets/69.html.618650ce.js"><link rel="prefetch" href="/assets/7.html.213eaadf.js"><link rel="prefetch" href="/assets/70.html.9d717256.js"><link rel="prefetch" href="/assets/71.html.7e7f16b0.js"><link rel="prefetch" href="/assets/72.html.ac9918d0.js"><link rel="prefetch" href="/assets/73.html.c5ca0eb4.js"><link rel="prefetch" href="/assets/74.html.3d949922.js"><link rel="prefetch" href="/assets/75.html.c3f02bd5.js"><link rel="prefetch" href="/assets/76.html.6091d630.js"><link rel="prefetch" href="/assets/77.html.718dbec3.js"><link rel="prefetch" href="/assets/78.html.e8ce2655.js"><link rel="prefetch" href="/assets/79.html.0461e3a6.js"><link rel="prefetch" href="/assets/8.html.abe9fed5.js"><link rel="prefetch" href="/assets/80.html.ca5a646d.js"><link rel="prefetch" href="/assets/81.html.2e23060c.js"><link rel="prefetch" href="/assets/82.html.8983ed47.js"><link rel="prefetch" href="/assets/83.html.9e9ba7dc.js"><link rel="prefetch" href="/assets/84.html.0503fff0.js"><link rel="prefetch" href="/assets/85.html.1e2fbf66.js"><link rel="prefetch" href="/assets/86.html.953395ac.js"><link rel="prefetch" href="/assets/87.html.aef2bb24.js"><link rel="prefetch" href="/assets/88.html.0ec29698.js"><link rel="prefetch" href="/assets/89.html.40a390be.js"><link rel="prefetch" href="/assets/9.html.9ae22ce4.js"><link rel="prefetch" href="/assets/90.html.4af85622.js"><link rel="prefetch" href="/assets/91.html.6d4cf67e.js"><link rel="prefetch" href="/assets/92.html.3bfa6320.js"><link rel="prefetch" href="/assets/93.html.67f8b61d.js"><link rel="prefetch" href="/assets/94.html.675e5734.js"><link rel="prefetch" href="/assets/95.html.55b1dd85.js"><link rel="prefetch" href="/assets/96.html.88289f6a.js"><link rel="prefetch" href="/assets/97.html.013ae5df.js"><link rel="prefetch" href="/assets/98.html.82596b4a.js"><link rel="prefetch" href="/assets/99.html.d6666293.js"><link rel="prefetch" href="/assets/1.html.35685385.js"><link rel="prefetch" href="/assets/10.html.37d1f8bd.js"><link rel="prefetch" href="/assets/11.html.2fa808b6.js"><link rel="prefetch" href="/assets/12.html.783cccc3.js"><link rel="prefetch" href="/assets/13.html.4773852c.js"><link rel="prefetch" href="/assets/14.html.0df1cdbe.js"><link rel="prefetch" href="/assets/15.html.f59d083f.js"><link rel="prefetch" href="/assets/16.html.e0400f91.js"><link rel="prefetch" href="/assets/17.html.a2026690.js"><link rel="prefetch" href="/assets/18.html.6b7c38f0.js"><link rel="prefetch" href="/assets/19.html.2ae59656.js"><link rel="prefetch" href="/assets/2.html.b6e07cbc.js"><link rel="prefetch" href="/assets/20.html.fed99c33.js"><link rel="prefetch" href="/assets/21.html.360c1d5c.js"><link rel="prefetch" href="/assets/22.html.03f283a7.js"><link rel="prefetch" href="/assets/23.html.770e4abd.js"><link rel="prefetch" href="/assets/24.html.df4d8a18.js"><link rel="prefetch" href="/assets/25.html.f07edf6d.js"><link rel="prefetch" href="/assets/26.html.3aebd524.js"><link rel="prefetch" href="/assets/27.html.3bcfb3df.js"><link rel="prefetch" href="/assets/28.html.44404f35.js"><link rel="prefetch" href="/assets/29.html.2b3b185c.js"><link rel="prefetch" href="/assets/3.html.1d213295.js"><link rel="prefetch" href="/assets/30.html.1d944d44.js"><link rel="prefetch" href="/assets/31.html.36d01352.js"><link rel="prefetch" href="/assets/32.html.3ed9bf0f.js"><link rel="prefetch" href="/assets/33.html.224621af.js"><link rel="prefetch" href="/assets/34.html.e65bd785.js"><link rel="prefetch" href="/assets/35.html.4df938f7.js"><link rel="prefetch" href="/assets/36.html.ec76883b.js"><link rel="prefetch" href="/assets/37.html.d27712a9.js"><link rel="prefetch" href="/assets/38.html.effdf661.js"><link rel="prefetch" href="/assets/39.html.bc37b704.js"><link rel="prefetch" href="/assets/4.html.efc93cf1.js"><link rel="prefetch" href="/assets/40.html.bbedf16d.js"><link rel="prefetch" href="/assets/41.html.43d18394.js"><link rel="prefetch" href="/assets/42.html.c9dec54d.js"><link rel="prefetch" href="/assets/43.html.6302d6b6.js"><link rel="prefetch" href="/assets/44.html.52123289.js"><link rel="prefetch" href="/assets/45.html.92cf405e.js"><link rel="prefetch" href="/assets/46.html.3a48340d.js"><link rel="prefetch" href="/assets/47.html.05512743.js"><link rel="prefetch" href="/assets/48.html.0cb89203.js"><link rel="prefetch" href="/assets/49.html.138372d0.js"><link rel="prefetch" href="/assets/5.html.62b93b36.js"><link rel="prefetch" href="/assets/50.html.99e4d0bf.js"><link rel="prefetch" href="/assets/51.html.1c3158fd.js"><link rel="prefetch" href="/assets/52.html.ae92bae9.js"><link rel="prefetch" href="/assets/53.html.ff8624c1.js"><link rel="prefetch" href="/assets/54.html.7266cd22.js"><link rel="prefetch" href="/assets/55.html.f5ef6e19.js"><link rel="prefetch" href="/assets/56.html.234fcfea.js"><link rel="prefetch" href="/assets/57.html.8157c6d4.js"><link rel="prefetch" href="/assets/58.html.d932b01b.js"><link rel="prefetch" href="/assets/59.html.37ef38d6.js"><link rel="prefetch" href="/assets/6.html.dd1f39d7.js"><link rel="prefetch" href="/assets/60.html.3a12f8fc.js"><link rel="prefetch" href="/assets/61.html.58e03455.js"><link rel="prefetch" href="/assets/62.html.d90f7c4b.js"><link rel="prefetch" href="/assets/63.html.d5fa0bc3.js"><link rel="prefetch" href="/assets/64.html.9350f6de.js"><link rel="prefetch" href="/assets/65.html.5e29014b.js"><link rel="prefetch" href="/assets/66.html.b3a6cc86.js"><link rel="prefetch" href="/assets/67.html.14de0fd5.js"><link rel="prefetch" href="/assets/68.html.983fc2e8.js"><link rel="prefetch" href="/assets/69.html.6e0f2252.js"><link rel="prefetch" href="/assets/70.html.d6f46382.js"><link rel="prefetch" href="/assets/71.html.8ce3e0c9.js"><link rel="prefetch" href="/assets/72.html.8ad4fa1d.js"><link rel="prefetch" href="/assets/73.html.9f3f36c6.js"><link rel="prefetch" href="/assets/74.html.9c74950c.js"><link rel="prefetch" href="/assets/75.html.b16f6304.js"><link rel="prefetch" href="/assets/76.html.0abe795c.js"><link rel="prefetch" href="/assets/77.html.f3880998.js"><link rel="prefetch" href="/assets/78.html.b203ab61.js"><link rel="prefetch" href="/assets/79.html.3dfeacc8.js"><link rel="prefetch" href="/assets/8.html.57127c98.js"><link rel="prefetch" href="/assets/80.html.419994bc.js"><link rel="prefetch" href="/assets/81.html.d819cedb.js"><link rel="prefetch" href="/assets/82.html.02c1ffd7.js"><link rel="prefetch" href="/assets/83.html.58effd31.js"><link rel="prefetch" href="/assets/84.html.a55178d9.js"><link rel="prefetch" href="/assets/85.html.e83fb3cb.js"><link rel="prefetch" href="/assets/86.html.673deeae.js"><link rel="prefetch" href="/assets/87.html.feaaeca4.js"><link rel="prefetch" href="/assets/88.html.3f9bbaf5.js"><link rel="prefetch" href="/assets/89.html.02f317dc.js"><link rel="prefetch" href="/assets/9.html.d56adf76.js"><link rel="prefetch" href="/assets/90.html.094dae18.js"><link rel="prefetch" href="/assets/91.html.efb356fe.js"><link rel="prefetch" href="/assets/92.html.35281ad8.js"><link rel="prefetch" href="/assets/93.html.72e22018.js"><link rel="prefetch" href="/assets/94.html.42010db1.js"><link rel="prefetch" href="/assets/95.html.5f1d3253.js"><link rel="prefetch" href="/assets/96.html.a42caadf.js"><link rel="prefetch" href="/assets/97.html.8cb4f9b9.js"><link rel="prefetch" href="/assets/98.html.da67854e.js"><link rel="prefetch" href="/assets/99.html.8aa227bf.js"><link rel="prefetch" href="/assets/index.html.4bf5501f.js"><link rel="prefetch" href="/assets/index.html.f0ab2ae0.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.b7520929.js"><link rel="prefetch" href="/assets/index.html.6541da12.js"><link rel="prefetch" href="/assets/go_route.html.5f014a17.js"><link rel="prefetch" href="/assets/index.html.6aa054c4.js"><link rel="prefetch" href="/assets/index.html.df92c47d.js"><link rel="prefetch" href="/assets/bitwise.html.8f4007d0.js"><link rel="prefetch" href="/assets/catalogue.html.eb6be905.js"><link rel="prefetch" href="/assets/go-air.html.a6b5c5d7.js"><link rel="prefetch" href="/assets/go-version.html.ebc8e38a.js"><link rel="prefetch" href="/assets/go_file.html.cde0c39b.js"><link rel="prefetch" href="/assets/go_mod.html.d0a762cc.js"><link rel="prefetch" href="/assets/mod.html.e524ba4e.js"><link rel="prefetch" href="/assets/name.html.d20270e8.js"><link rel="prefetch" href="/assets/index.html.08b9fec6.js"><link rel="prefetch" href="/assets/zhenze.html.e9d434a2.js"><link rel="prefetch" href="/assets/index.html.4c43a78c.js"><link rel="prefetch" href="/assets/1.html.8386d29c.js"><link rel="prefetch" href="/assets/10.html.11ee2e0d.js"><link rel="prefetch" href="/assets/11.html.d39ee792.js"><link rel="prefetch" href="/assets/12.html.dd6e1fe9.js"><link rel="prefetch" href="/assets/13.html.d948b075.js"><link rel="prefetch" href="/assets/14.html.5057a8f7.js"><link rel="prefetch" href="/assets/15.html.8f4c2d05.js"><link rel="prefetch" href="/assets/16.html.2e37dcd7.js"><link rel="prefetch" href="/assets/17.html.e43fb92e.js"><link rel="prefetch" href="/assets/18.html.8e386073.js"><link rel="prefetch" href="/assets/19.html.9b353ec5.js"><link rel="prefetch" href="/assets/2.html.7d55e6e8.js"><link rel="prefetch" href="/assets/20.html.b8f36e55.js"><link rel="prefetch" href="/assets/21.html.a97df21a.js"><link rel="prefetch" href="/assets/22.html.2c7e023b.js"><link rel="prefetch" href="/assets/23.html.61cd2b8a.js"><link rel="prefetch" href="/assets/24.html.248156db.js"><link rel="prefetch" href="/assets/25.html.e3aac51b.js"><link rel="prefetch" href="/assets/26.html.dd78ac8f.js"><link rel="prefetch" href="/assets/27.html.ef6dac81.js"><link rel="prefetch" href="/assets/28.html.ced42ff1.js"><link rel="prefetch" href="/assets/29.html.8c50ffe0.js"><link rel="prefetch" href="/assets/3.html.5c04b70a.js"><link rel="prefetch" href="/assets/30.html.9c52b5f0.js"><link rel="prefetch" href="/assets/4.html.e51395cb.js"><link rel="prefetch" href="/assets/5.html.ea205011.js"><link rel="prefetch" href="/assets/6.html.24ac3627.js"><link rel="prefetch" href="/assets/7.html.26bb3c44.js"><link rel="prefetch" href="/assets/8.html.d84bcc52.js"><link rel="prefetch" href="/assets/9.html.948a7205.js"><link rel="prefetch" href="/assets/chan底层分析.html.961fd6fb.js"><link rel="prefetch" href="/assets/eth.html.c2419c5e.js"><link rel="prefetch" href="/assets/file.html.905bc91e.js"><link rel="prefetch" href="/assets/gofloat.html.3d08bfe9.js"><link rel="prefetch" href="/assets/Go汇编.html.7845005a.js"><link rel="prefetch" href="/assets/九型人格.html.63309c48.js"><link rel="prefetch" href="/assets/反射.html.73fdc62e.js"><link rel="prefetch" href="/assets/并发.html.98d1704e.js"><link rel="prefetch" href="/assets/字节青训营进阶面试准备.html.afc8e584.js"><link rel="prefetch" href="/assets/接口设计稿.html.93569e29.js"><link rel="prefetch" href="/assets/码上掘金主题创作活动.html.e476e91d.js"><link rel="prefetch" href="/assets/青训营题库.html.e077195b.js"><link rel="prefetch" href="/assets/index.html.440c4962.js"><link rel="prefetch" href="/assets/CONTRIBUTING.html.23fb5c19.js"><link rel="prefetch" href="/assets/index.html.43d4adb9.js"><link rel="prefetch" href="/assets/index.html.ec338edf.js"><link rel="prefetch" href="/assets/1.html.181af967.js"><link rel="prefetch" href="/assets/10.html.aeb8ec5b.js"><link rel="prefetch" href="/assets/11.html.1fbb65eb.js"><link rel="prefetch" href="/assets/12.html.31b189ee.js"><link rel="prefetch" href="/assets/13.html.7639d568.js"><link rel="prefetch" href="/assets/14.html.f76c6aaa.js"><link rel="prefetch" href="/assets/15.html.79c612c6.js"><link rel="prefetch" href="/assets/16.html.71436d0d.js"><link rel="prefetch" href="/assets/17.html.31a6c7c1.js"><link rel="prefetch" href="/assets/18.html.c42f8590.js"><link rel="prefetch" href="/assets/19.html.de7973ec.js"><link rel="prefetch" href="/assets/2.html.d34639e5.js"><link rel="prefetch" href="/assets/20.html.ee0c172a.js"><link rel="prefetch" href="/assets/21.html.1a5ea1e9.js"><link rel="prefetch" href="/assets/22.html.8f1b6be1.js"><link rel="prefetch" href="/assets/23.html.867469da.js"><link rel="prefetch" href="/assets/24.html.6f7a5916.js"><link rel="prefetch" href="/assets/25.html.2eb534f8.js"><link rel="prefetch" href="/assets/26.html.956cc559.js"><link rel="prefetch" href="/assets/27.html.0f9b6779.js"><link rel="prefetch" href="/assets/28.html.1f4d1c8c.js"><link rel="prefetch" href="/assets/29.html.fad3607e.js"><link rel="prefetch" href="/assets/3.html.43cd8237.js"><link rel="prefetch" href="/assets/30.html.3cc34cff.js"><link rel="prefetch" href="/assets/31.html.f88b3e32.js"><link rel="prefetch" href="/assets/32.html.c8fef4e6.js"><link rel="prefetch" href="/assets/33.html.3d278536.js"><link rel="prefetch" href="/assets/34.html.d3429470.js"><link rel="prefetch" href="/assets/35.html.0feba1e6.js"><link rel="prefetch" href="/assets/36.html.4903d8ab.js"><link rel="prefetch" href="/assets/37.html.ae357055.js"><link rel="prefetch" href="/assets/38.html.5df27fb2.js"><link rel="prefetch" href="/assets/39.html.c13f98c4.js"><link rel="prefetch" href="/assets/4.html.e0796ace.js"><link rel="prefetch" href="/assets/40.html.5606415c.js"><link rel="prefetch" href="/assets/41.html.44b91227.js"><link rel="prefetch" href="/assets/42.html.75e5d68c.js"><link rel="prefetch" href="/assets/43.html.22e31d61.js"><link rel="prefetch" href="/assets/44.html.89377185.js"><link rel="prefetch" href="/assets/45.html.ff237797.js"><link rel="prefetch" href="/assets/46.html.b34a4f44.js"><link rel="prefetch" href="/assets/47.html.deaf8cb9.js"><link rel="prefetch" href="/assets/48.html.b3310e3a.js"><link rel="prefetch" href="/assets/49.html.344f63f4.js"><link rel="prefetch" href="/assets/5.html.d15ca3e9.js"><link rel="prefetch" href="/assets/50.html.455d1618.js"><link rel="prefetch" href="/assets/51.html.14bf3a66.js"><link rel="prefetch" href="/assets/52.html.ed95c0be.js"><link rel="prefetch" href="/assets/53.html.7b4e75ab.js"><link rel="prefetch" href="/assets/54.html.c17100b2.js"><link rel="prefetch" href="/assets/55.html.1e89c47b.js"><link rel="prefetch" href="/assets/56.html.0b6e4264.js"><link rel="prefetch" href="/assets/57.html.5c1040d5.js"><link rel="prefetch" href="/assets/58.html.3583a8cc.js"><link rel="prefetch" href="/assets/59.html.6f950c99.js"><link rel="prefetch" href="/assets/6.html.555270da.js"><link rel="prefetch" href="/assets/60.html.2332b79d.js"><link rel="prefetch" href="/assets/61.html.05cab07c.js"><link rel="prefetch" href="/assets/62.html.2d0a4b2c.js"><link rel="prefetch" href="/assets/63.html.fd730fcb.js"><link rel="prefetch" href="/assets/64.html.721005f2.js"><link rel="prefetch" href="/assets/65.html.1c23ddc0.js"><link rel="prefetch" href="/assets/66.html.0e767f56.js"><link rel="prefetch" href="/assets/67.html.b704f509.js"><link rel="prefetch" href="/assets/68.html.8d9d4d03.js"><link rel="prefetch" href="/assets/69.html.fb3c900e.js"><link rel="prefetch" href="/assets/7.html.025443e6.js"><link rel="prefetch" href="/assets/70.html.be4d93af.js"><link rel="prefetch" href="/assets/71.html.fc05e999.js"><link rel="prefetch" href="/assets/72.html.1d567b9b.js"><link rel="prefetch" href="/assets/73.html.36a4bf1b.js"><link rel="prefetch" href="/assets/74.html.190317ca.js"><link rel="prefetch" href="/assets/75.html.015eece5.js"><link rel="prefetch" href="/assets/76.html.484f865c.js"><link rel="prefetch" href="/assets/77.html.ded81168.js"><link rel="prefetch" href="/assets/78.html.eff5293b.js"><link rel="prefetch" href="/assets/79.html.b6593a5e.js"><link rel="prefetch" href="/assets/8.html.c59d5723.js"><link rel="prefetch" href="/assets/80.html.83ea0dad.js"><link rel="prefetch" href="/assets/81.html.46468093.js"><link rel="prefetch" href="/assets/82.html.92b29797.js"><link rel="prefetch" href="/assets/83.html.d93726ef.js"><link rel="prefetch" href="/assets/84.html.f40ce97b.js"><link rel="prefetch" href="/assets/85.html.522e4c1c.js"><link rel="prefetch" href="/assets/86.html.aa4d7e58.js"><link rel="prefetch" href="/assets/87.html.363166a2.js"><link rel="prefetch" href="/assets/88.html.68cbe74b.js"><link rel="prefetch" href="/assets/89.html.9ba09dc4.js"><link rel="prefetch" href="/assets/9.html.ce7eb837.js"><link rel="prefetch" href="/assets/90.html.482e7aa5.js"><link rel="prefetch" href="/assets/91.html.246b7085.js"><link rel="prefetch" href="/assets/92.html.55c7ebb8.js"><link rel="prefetch" href="/assets/93.html.b6ea2143.js"><link rel="prefetch" href="/assets/94.html.d7d2e8c9.js"><link rel="prefetch" href="/assets/95.html.7f610dec.js"><link rel="prefetch" href="/assets/96.html.a6cdda48.js"><link rel="prefetch" href="/assets/97.html.f03eeeca.js"><link rel="prefetch" href="/assets/98.html.cf3876a7.js"><link rel="prefetch" href="/assets/99.html.f8838951.js"><link rel="prefetch" href="/assets/1.html.1f86c55e.js"><link rel="prefetch" href="/assets/10.html.b2613126.js"><link rel="prefetch" href="/assets/11.html.bee74ee5.js"><link rel="prefetch" href="/assets/12.html.cf4188d7.js"><link rel="prefetch" href="/assets/13.html.83b20d55.js"><link rel="prefetch" href="/assets/14.html.af369a7c.js"><link rel="prefetch" href="/assets/15.html.fc6895fc.js"><link rel="prefetch" href="/assets/16.html.3ff847c2.js"><link rel="prefetch" href="/assets/17.html.51e6a011.js"><link rel="prefetch" href="/assets/18.html.40cb4eef.js"><link rel="prefetch" href="/assets/19.html.4847ee5e.js"><link rel="prefetch" href="/assets/2.html.d2006ff7.js"><link rel="prefetch" href="/assets/20.html.b4f0c805.js"><link rel="prefetch" href="/assets/21.html.e6e14492.js"><link rel="prefetch" href="/assets/22.html.271d3534.js"><link rel="prefetch" href="/assets/23.html.d24f68b8.js"><link rel="prefetch" href="/assets/24.html.491029b2.js"><link rel="prefetch" href="/assets/25.html.003aa6b0.js"><link rel="prefetch" href="/assets/26.html.705759d7.js"><link rel="prefetch" href="/assets/27.html.c47c05da.js"><link rel="prefetch" href="/assets/28.html.e11f331f.js"><link rel="prefetch" href="/assets/29.html.8ad90cad.js"><link rel="prefetch" href="/assets/3.html.d7505979.js"><link rel="prefetch" href="/assets/30.html.0dd349ac.js"><link rel="prefetch" href="/assets/31.html.2ac32dbf.js"><link rel="prefetch" href="/assets/32.html.edeb9d7c.js"><link rel="prefetch" href="/assets/33.html.bbb992e1.js"><link rel="prefetch" href="/assets/34.html.82b1e49a.js"><link rel="prefetch" href="/assets/35.html.1ba7deac.js"><link rel="prefetch" href="/assets/36.html.de852b73.js"><link rel="prefetch" href="/assets/37.html.4afd3f36.js"><link rel="prefetch" href="/assets/38.html.c2f08251.js"><link rel="prefetch" href="/assets/39.html.ae0fc6e0.js"><link rel="prefetch" href="/assets/4.html.8cb7ba8a.js"><link rel="prefetch" href="/assets/40.html.75e24b3d.js"><link rel="prefetch" href="/assets/41.html.94c0fe0c.js"><link rel="prefetch" href="/assets/42.html.6ce7a94b.js"><link rel="prefetch" href="/assets/43.html.5de30b27.js"><link rel="prefetch" href="/assets/44.html.694d5254.js"><link rel="prefetch" href="/assets/45.html.dfa8bbba.js"><link rel="prefetch" href="/assets/46.html.4e7c9794.js"><link rel="prefetch" href="/assets/47.html.56b49ca4.js"><link rel="prefetch" href="/assets/48.html.7301c21c.js"><link rel="prefetch" href="/assets/49.html.b203ee12.js"><link rel="prefetch" href="/assets/5.html.fa6c4635.js"><link rel="prefetch" href="/assets/50.html.fefb74da.js"><link rel="prefetch" href="/assets/6.html.2d21680a.js"><link rel="prefetch" href="/assets/7.html.bd2a054d.js"><link rel="prefetch" href="/assets/8.html.744537ae.js"><link rel="prefetch" href="/assets/9.html.ef454dce.js"><link rel="prefetch" href="/assets/1.html.d8a8dbcd.js"><link rel="prefetch" href="/assets/10.html.ddd4abc9.js"><link rel="prefetch" href="/assets/11.html.73b27570.js"><link rel="prefetch" href="/assets/12.html.3fc07e0d.js"><link rel="prefetch" href="/assets/13.html.93b261e3.js"><link rel="prefetch" href="/assets/14.html.2f5b0a9e.js"><link rel="prefetch" href="/assets/15.html.1fcf9583.js"><link rel="prefetch" href="/assets/16.html.c31c7ba4.js"><link rel="prefetch" href="/assets/17.html.971c029e.js"><link rel="prefetch" href="/assets/18.html.eb82ad90.js"><link rel="prefetch" href="/assets/19.html.36df7a8b.js"><link rel="prefetch" href="/assets/2.html.4ca5650f.js"><link rel="prefetch" href="/assets/20.html.5922df0c.js"><link rel="prefetch" href="/assets/21.html.a5cef635.js"><link rel="prefetch" href="/assets/22.html.2fcbeb1a.js"><link rel="prefetch" href="/assets/23.html.25921a79.js"><link rel="prefetch" href="/assets/24.html.8ba17566.js"><link rel="prefetch" href="/assets/25.html.4010f0b3.js"><link rel="prefetch" href="/assets/26.html.742648a2.js"><link rel="prefetch" href="/assets/27.html.000b1500.js"><link rel="prefetch" href="/assets/28.html.2c7a0281.js"><link rel="prefetch" href="/assets/29.html.1ac46002.js"><link rel="prefetch" href="/assets/3.html.50699233.js"><link rel="prefetch" href="/assets/30.html.f6ed1e76.js"><link rel="prefetch" href="/assets/31.html.88e83901.js"><link rel="prefetch" href="/assets/32.html.55f2521c.js"><link rel="prefetch" href="/assets/33.html.fa5920e7.js"><link rel="prefetch" href="/assets/34.html.d400e8f0.js"><link rel="prefetch" href="/assets/35.html.9a3c43af.js"><link rel="prefetch" href="/assets/36.html.b7059abc.js"><link rel="prefetch" href="/assets/37.html.61745b3f.js"><link rel="prefetch" href="/assets/38.html.37e61eda.js"><link rel="prefetch" href="/assets/39.html.ff20f328.js"><link rel="prefetch" href="/assets/4.html.19459ea2.js"><link rel="prefetch" href="/assets/40.html.42fab185.js"><link rel="prefetch" href="/assets/41.html.90d42606.js"><link rel="prefetch" href="/assets/42.html.05e28c1c.js"><link rel="prefetch" href="/assets/43.html.497ac4f7.js"><link rel="prefetch" href="/assets/44.html.50a01c2a.js"><link rel="prefetch" href="/assets/45.html.e5839b69.js"><link rel="prefetch" href="/assets/46.html.bc0b6954.js"><link rel="prefetch" href="/assets/47.html.2fd66959.js"><link rel="prefetch" href="/assets/48.html.85e6f8ff.js"><link rel="prefetch" href="/assets/49.html.93a8839c.js"><link rel="prefetch" href="/assets/5.html.8ddcfc81.js"><link rel="prefetch" href="/assets/6.html.6d698642.js"><link rel="prefetch" href="/assets/7.html.c3f63e24.js"><link rel="prefetch" href="/assets/8.html.c406900b.js"><link rel="prefetch" href="/assets/9.html.d167cd65.js"><link rel="prefetch" href="/assets/1.html.12e1d955.js"><link rel="prefetch" href="/assets/10.html.6e5ec656.js"><link rel="prefetch" href="/assets/100.html.8f1f3145.js"><link rel="prefetch" href="/assets/11.html.586b3880.js"><link rel="prefetch" href="/assets/12.html.63548613.js"><link rel="prefetch" href="/assets/13.html.2c21b586.js"><link rel="prefetch" href="/assets/14.html.a7c5b8df.js"><link rel="prefetch" href="/assets/15.html.3384d72a.js"><link rel="prefetch" href="/assets/16.html.787b4e25.js"><link rel="prefetch" href="/assets/17.html.15cd97a0.js"><link rel="prefetch" href="/assets/18.html.18489589.js"><link rel="prefetch" href="/assets/19.html.e791d0bd.js"><link rel="prefetch" href="/assets/2.html.2399f618.js"><link rel="prefetch" href="/assets/20.html.d3e0d8f4.js"><link rel="prefetch" href="/assets/21.html.91dbf417.js"><link rel="prefetch" href="/assets/22.html.4dda0084.js"><link rel="prefetch" href="/assets/23.html.f5f28a55.js"><link rel="prefetch" href="/assets/24.html.8d07e86e.js"><link rel="prefetch" href="/assets/25.html.e22fc963.js"><link rel="prefetch" href="/assets/26.html.5e7f10a4.js"><link rel="prefetch" href="/assets/27.html.a8dd24f2.js"><link rel="prefetch" href="/assets/28.html.6b8e7a0e.js"><link rel="prefetch" href="/assets/29.html.fd2e2da1.js"><link rel="prefetch" href="/assets/3.html.9593b252.js"><link rel="prefetch" href="/assets/30.html.cf95d061.js"><link rel="prefetch" href="/assets/31.html.ec49ccca.js"><link rel="prefetch" href="/assets/32.html.dd7f0c7d.js"><link rel="prefetch" href="/assets/33.html.2e4b31d0.js"><link rel="prefetch" href="/assets/34.html.690482c8.js"><link rel="prefetch" href="/assets/35.html.45d3b8cd.js"><link rel="prefetch" href="/assets/36.html.d733f7a3.js"><link rel="prefetch" href="/assets/37.html.0fdbda96.js"><link rel="prefetch" href="/assets/38.html.8a42dac0.js"><link rel="prefetch" href="/assets/39.html.b8a03c32.js"><link rel="prefetch" href="/assets/4.html.d0f60f36.js"><link rel="prefetch" href="/assets/40.html.e7e4f5f5.js"><link rel="prefetch" href="/assets/41.html.43129c3c.js"><link rel="prefetch" href="/assets/42.html.d093cd3c.js"><link rel="prefetch" href="/assets/43.html.4fc693fb.js"><link rel="prefetch" href="/assets/44.html.03766f2f.js"><link rel="prefetch" href="/assets/45.html.ecd976c0.js"><link rel="prefetch" href="/assets/46.html.fbf69ee9.js"><link rel="prefetch" href="/assets/47.html.1131d96c.js"><link rel="prefetch" href="/assets/48.html.5c2fc6b5.js"><link rel="prefetch" href="/assets/49.html.f4f40c3b.js"><link rel="prefetch" href="/assets/5.html.71041c1b.js"><link rel="prefetch" href="/assets/50.html.65180d47.js"><link rel="prefetch" href="/assets/51.html.76dcaeb8.js"><link rel="prefetch" href="/assets/52.html.abc1a73c.js"><link rel="prefetch" href="/assets/53.html.7f3edc01.js"><link rel="prefetch" href="/assets/54.html.e63d0366.js"><link rel="prefetch" href="/assets/55.html.04b05e90.js"><link rel="prefetch" href="/assets/56.html.ab4d34a8.js"><link rel="prefetch" href="/assets/57.html.556ad42b.js"><link rel="prefetch" href="/assets/58.html.722de994.js"><link rel="prefetch" href="/assets/59.html.348e2c2e.js"><link rel="prefetch" href="/assets/6.html.b8f3c97a.js"><link rel="prefetch" href="/assets/60.html.20669f2d.js"><link rel="prefetch" href="/assets/61.html.289e704a.js"><link rel="prefetch" href="/assets/62.html.5b723881.js"><link rel="prefetch" href="/assets/63.html.9898bc2b.js"><link rel="prefetch" href="/assets/64.html.2ede9079.js"><link rel="prefetch" href="/assets/65.html.535c299f.js"><link rel="prefetch" href="/assets/66.html.fc838c00.js"><link rel="prefetch" href="/assets/67.html.970cb2e8.js"><link rel="prefetch" href="/assets/68.html.f035235e.js"><link rel="prefetch" href="/assets/69.html.f7285f57.js"><link rel="prefetch" href="/assets/7.html.c11e382d.js"><link rel="prefetch" href="/assets/70.html.7e02e8a8.js"><link rel="prefetch" href="/assets/71.html.427052a8.js"><link rel="prefetch" href="/assets/72.html.598a5e33.js"><link rel="prefetch" href="/assets/73.html.1bf5b224.js"><link rel="prefetch" href="/assets/74.html.0cf17118.js"><link rel="prefetch" href="/assets/75.html.3b6d25fe.js"><link rel="prefetch" href="/assets/76.html.e855c0d5.js"><link rel="prefetch" href="/assets/77.html.d0e74544.js"><link rel="prefetch" href="/assets/78.html.44eb2e1b.js"><link rel="prefetch" href="/assets/79.html.b4517278.js"><link rel="prefetch" href="/assets/8.html.ea0c4ecd.js"><link rel="prefetch" href="/assets/80.html.1f5f1e4f.js"><link rel="prefetch" href="/assets/81.html.977feafc.js"><link rel="prefetch" href="/assets/82.html.bd5e2b37.js"><link rel="prefetch" href="/assets/83.html.c6f11df7.js"><link rel="prefetch" href="/assets/84.html.6adf0471.js"><link rel="prefetch" href="/assets/85.html.b47db342.js"><link rel="prefetch" href="/assets/86.html.28ae2959.js"><link rel="prefetch" href="/assets/87.html.7e4417d0.js"><link rel="prefetch" href="/assets/88.html.46570149.js"><link rel="prefetch" href="/assets/89.html.53b8bd1f.js"><link rel="prefetch" href="/assets/9.html.aca98b4d.js"><link rel="prefetch" href="/assets/90.html.ebb6f422.js"><link rel="prefetch" href="/assets/91.html.01ffd730.js"><link rel="prefetch" href="/assets/92.html.bc0387c4.js"><link rel="prefetch" href="/assets/93.html.2c84dcce.js"><link rel="prefetch" href="/assets/94.html.83d464fb.js"><link rel="prefetch" href="/assets/95.html.dad4365f.js"><link rel="prefetch" href="/assets/96.html.8f8a0e97.js"><link rel="prefetch" href="/assets/97.html.1441a95b.js"><link rel="prefetch" href="/assets/98.html.6d20cf34.js"><link rel="prefetch" href="/assets/99.html.ce8ec064.js"><link rel="prefetch" href="/assets/1.html.4c96cd96.js"><link rel="prefetch" href="/assets/10.html.69e0e3a6.js"><link rel="prefetch" href="/assets/11.html.7533c60d.js"><link rel="prefetch" href="/assets/12.html.81a1272a.js"><link rel="prefetch" href="/assets/13.html.697ecb56.js"><link rel="prefetch" href="/assets/14.html.c2ff71ab.js"><link rel="prefetch" href="/assets/15.html.0f78b714.js"><link rel="prefetch" href="/assets/16.html.12e8bf8d.js"><link rel="prefetch" href="/assets/17.html.61a61372.js"><link rel="prefetch" href="/assets/18.html.d36b60a7.js"><link rel="prefetch" href="/assets/19.html.3094f4ba.js"><link rel="prefetch" href="/assets/2.html.f2f93109.js"><link rel="prefetch" href="/assets/20.html.61689db6.js"><link rel="prefetch" href="/assets/21.html.69fbcc26.js"><link rel="prefetch" href="/assets/22.html.037c28e6.js"><link rel="prefetch" href="/assets/23.html.3cb193b2.js"><link rel="prefetch" href="/assets/24.html.44966761.js"><link rel="prefetch" href="/assets/25.html.b574bcce.js"><link rel="prefetch" href="/assets/26.html.868e13a7.js"><link rel="prefetch" href="/assets/27.html.91d6cf15.js"><link rel="prefetch" href="/assets/28.html.f9014837.js"><link rel="prefetch" href="/assets/29.html.1adbaaeb.js"><link rel="prefetch" href="/assets/3.html.04dbe456.js"><link rel="prefetch" href="/assets/30.html.a57c1a1e.js"><link rel="prefetch" href="/assets/31.html.80c0d669.js"><link rel="prefetch" href="/assets/32.html.836c6144.js"><link rel="prefetch" href="/assets/33.html.327ececd.js"><link rel="prefetch" href="/assets/34.html.627d4bbd.js"><link rel="prefetch" href="/assets/35.html.21e2f2d0.js"><link rel="prefetch" href="/assets/36.html.5604225b.js"><link rel="prefetch" href="/assets/37.html.09373f03.js"><link rel="prefetch" href="/assets/38.html.609db671.js"><link rel="prefetch" href="/assets/39.html.4d974371.js"><link rel="prefetch" href="/assets/4.html.936ee265.js"><link rel="prefetch" href="/assets/40.html.8d2fcfa7.js"><link rel="prefetch" href="/assets/41.html.2b03d28d.js"><link rel="prefetch" href="/assets/42.html.1e3e144b.js"><link rel="prefetch" href="/assets/43.html.e8fe1528.js"><link rel="prefetch" href="/assets/44.html.f774283b.js"><link rel="prefetch" href="/assets/45.html.7c9eef96.js"><link rel="prefetch" href="/assets/46.html.c35c2bad.js"><link rel="prefetch" href="/assets/47.html.0277c1aa.js"><link rel="prefetch" href="/assets/48.html.1996ce89.js"><link rel="prefetch" href="/assets/49.html.da596a60.js"><link rel="prefetch" href="/assets/5.html.d01990d1.js"><link rel="prefetch" href="/assets/50.html.658b9181.js"><link rel="prefetch" href="/assets/51.html.ec104ce8.js"><link rel="prefetch" href="/assets/52.html.6eb5fdcc.js"><link rel="prefetch" href="/assets/53.html.2d4c5680.js"><link rel="prefetch" href="/assets/54.html.01650d81.js"><link rel="prefetch" href="/assets/55.html.c69e69b4.js"><link rel="prefetch" href="/assets/56.html.91bf4ea2.js"><link rel="prefetch" href="/assets/57.html.a9cc7ade.js"><link rel="prefetch" href="/assets/58.html.dbd34541.js"><link rel="prefetch" href="/assets/59.html.5bce77eb.js"><link rel="prefetch" href="/assets/6.html.49c3eba9.js"><link rel="prefetch" href="/assets/60.html.e626dd66.js"><link rel="prefetch" href="/assets/61.html.0fca3ada.js"><link rel="prefetch" href="/assets/62.html.6cca0022.js"><link rel="prefetch" href="/assets/63.html.4780ec85.js"><link rel="prefetch" href="/assets/64.html.bde772b8.js"><link rel="prefetch" href="/assets/65.html.22b7a445.js"><link rel="prefetch" href="/assets/66.html.ca814f21.js"><link rel="prefetch" href="/assets/67.html.ff3e5e3c.js"><link rel="prefetch" href="/assets/68.html.028445c7.js"><link rel="prefetch" href="/assets/69.html.57fb80c2.js"><link rel="prefetch" href="/assets/70.html.3cd2d952.js"><link rel="prefetch" href="/assets/71.html.6df10395.js"><link rel="prefetch" href="/assets/72.html.d7199756.js"><link rel="prefetch" href="/assets/73.html.9cee9183.js"><link rel="prefetch" href="/assets/74.html.4a90b1ea.js"><link rel="prefetch" href="/assets/75.html.f7ef6f72.js"><link rel="prefetch" href="/assets/76.html.c8bd6ab7.js"><link rel="prefetch" href="/assets/77.html.f5dac632.js"><link rel="prefetch" href="/assets/78.html.0bfac968.js"><link rel="prefetch" href="/assets/79.html.61dbfa7f.js"><link rel="prefetch" href="/assets/8.html.b8a158d6.js"><link rel="prefetch" href="/assets/80.html.daf0e957.js"><link rel="prefetch" href="/assets/81.html.84d8d938.js"><link rel="prefetch" href="/assets/82.html.c57acb1b.js"><link rel="prefetch" href="/assets/83.html.04751104.js"><link rel="prefetch" href="/assets/84.html.feb5d080.js"><link rel="prefetch" href="/assets/85.html.cba1117b.js"><link rel="prefetch" href="/assets/86.html.99bea098.js"><link rel="prefetch" href="/assets/87.html.a49f11c5.js"><link rel="prefetch" href="/assets/88.html.3f084df3.js"><link rel="prefetch" href="/assets/89.html.c2b3ce9e.js"><link rel="prefetch" href="/assets/9.html.bc8c9aac.js"><link rel="prefetch" href="/assets/90.html.91fafb26.js"><link rel="prefetch" href="/assets/91.html.ab5978ec.js"><link rel="prefetch" href="/assets/92.html.8cbbe2bf.js"><link rel="prefetch" href="/assets/93.html.e90c71dc.js"><link rel="prefetch" href="/assets/94.html.e4e24777.js"><link rel="prefetch" href="/assets/95.html.cd92d188.js"><link rel="prefetch" href="/assets/96.html.ddf3fec1.js"><link rel="prefetch" href="/assets/97.html.a26dc0d2.js"><link rel="prefetch" href="/assets/98.html.9f77771f.js"><link rel="prefetch" href="/assets/99.html.c66ae497.js"><link rel="prefetch" href="/assets/index.html.b080207f.js"><link rel="prefetch" href="/assets/index.html.d9d4bb31.js"><link rel="prefetch" href="/assets/404.html.076305cb.js">
    <link rel="stylesheet" href="/assets/style.03848e77.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">你好</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/3293172751/cs-awesome-Block_Chain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/C-UB/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/markdown/1.md/" class="" aria-label="🔥 Go语言基础篇"><!--[--><!--]--> 🔥 Go语言基础篇 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/Gomd_super/" class="" aria-label="🔥 Go语言进阶篇"><!--[--><!--]--> 🔥 Go语言进阶篇 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/go-advancend/" class="" aria-label="🔥 Go语言高级篇"><!--[--><!--]--> 🔥 Go语言高级篇 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/3293172751/awesome-go" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="🤵关于我"><span class="title">🤵关于我</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/3293172751/cs-awesome-Block_Chain" rel="noopener noreferrer" target="_blank" aria-label="Github仓库"><!--[--><!--]--> Github仓库 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="我的博客"><!--[--><!--]--> 我的博客 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="知乎"><!--[--><!--]--> 知乎 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/C-UB/" rel="noopener noreferrer" target="_blank" aria-label="⛓️链学社组织"><!--[--><!--]--> ⛓️链学社组织 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="🏠首页"><!--[--><!--]--> 🏠首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://docker.nsddd.top/" rel="noopener noreferrer" target="_blank" aria-label="🐋docker文档"><!--[--><!--]--> 🐋docker文档 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="📚go文档"><span class="title">📚go文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/markdown/1.md/" class="" aria-label="🔥 Go语言基础篇"><!--[--><!--]--> 🔥 Go语言基础篇 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/Gomd_super/" class="" aria-label="🔥 Go语言进阶篇"><!--[--><!--]--> 🔥 Go语言进阶篇 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/go-advancend/" class="" aria-label="🔥 Go语言高级篇"><!--[--><!--]--> 🔥 Go语言高级篇 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/3293172751/awesome-go" rel="noopener noreferrer" target="_blank" aria-label="查看源码"><!--[--><!--]--> 查看源码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/Gomd_super/" class="sidebar-item sidebar-heading" aria-label="/Gomd_super/"><!--[--><!--]--> /Gomd_super/ <!--[--><!--]--></a><!----></li><li><a href="/Gomd_super/go-air.html" class="sidebar-item sidebar-heading" aria-label="go-air实现热加载"><!--[--><!--]--> go-air实现热加载 <!--[--><!--]--></a><!----></li><li><a href="/Gomd_super/name.html" class="sidebar-item sidebar-heading" aria-label="Go语言命名规范"><!--[--><!--]--> Go语言命名规范 <!--[--><!--]--></a><!----></li><li><a href="/Gomd_super/mod.html" class="sidebar-item sidebar-heading" aria-label="Go mod包"><!--[--><!--]--> Go mod包 <!--[--><!--]--></a><!----></li><li><a href="/Gomd_super/zhenze.html" class="sidebar-item sidebar-heading" aria-label="正则表达式语法速查表"><!--[--><!--]--> 正则表达式语法速查表 <!--[--><!--]--></a><!----></li><li><a href="/Gomd_super/go_file.html" class="sidebar-item sidebar-heading" aria-label="Go语言文本编码处理"><!--[--><!--]--> Go语言文本编码处理 <!--[--><!--]--></a><!----></li><li><a href="/Gomd_super/catalogue.html" class="sidebar-item sidebar-heading" aria-label="目录结构"><!--[--><!--]--> 目录结构 <!--[--><!--]--></a><!----></li><li><a href="/Gomd_super/bitwise.html" class="sidebar-item sidebar-heading" aria-label="位运算以及补码重点"><!--[--><!--]--> 位运算以及补码重点 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><ul><li><a href="https://github.com/cubxxw/iam" target="_blank" rel="noopener noreferrer">🔥 开源地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h1 id="第7节-高质量的makefile" tabindex="-1"><a class="header-anchor" href="#第7节-高质量的makefile" aria-hidden="true">#</a> 第7节 高质量的Makefile</h1><br><div><a href="6.md" style="float:left;">⬆️上一节🔗 </a><a href="8.md" style="float:right;"> ⬇️下一节🔗</a></div><br><blockquote><p>❤️💕💕During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><hr><nav class="table-of-contents"><ul><li><a aria-current="page" href="/projects/projects/7.html#低质量的makefile" class="router-link-active router-link-exact-active">低质量的makefile</a></li><li><a aria-current="page" href="/projects/projects/7.html#makefile-如何工作" class="router-link-active router-link-exact-active">makefile 如何工作</a><ul><li><a aria-current="page" href="/projects/projects/7.html#build-and-run" class="router-link-active router-link-exact-active">Build and Run</a></li><li><a aria-current="page" href="/projects/projects/7.html#cleaning-and-drying" class="router-link-active router-link-exact-active">Cleaning and DRYing</a></li><li><a aria-current="page" href="/projects/projects/7.html#phony-targets" class="router-link-active router-link-exact-active">PHONY targets</a></li><li><a aria-current="page" href="/projects/projects/7.html#recursive-make-targets" class="router-link-active router-link-exact-active">Recursive Make targets</a></li><li><a aria-current="page" href="/projects/projects/7.html#targets-for-docker-commands" class="router-link-active router-link-exact-active">Targets for Docker commands</a></li><li><a aria-current="page" href="/projects/projects/7.html#符号" class="router-link-active router-link-exact-active">@ 符号</a></li><li><a aria-current="page" href="/projects/projects/7.html#文件搜索-vpath" class="router-link-active router-link-exact-active">文件搜索 VPATH</a></li><li><a aria-current="page" href="/projects/projects/7.html#help-target" class="router-link-active router-link-exact-active">Help target</a></li><li><a aria-current="page" href="/projects/projects/7.html#conclusion-结论" class="router-link-active router-link-exact-active">Conclusion 结论</a></li></ul></li><li><a aria-current="page" href="/projects/projects/7.html#熟练makefile语法" class="router-link-active router-link-exact-active">熟练makefile语法</a><ul><li><a aria-current="page" href="/projects/projects/7.html#常用的-makefile-核心语法" class="router-link-active router-link-exact-active">常用的 Makefile 核心语法</a></li><li><a aria-current="page" href="/projects/projects/7.html#makefile-支持的通配符" class="router-link-active router-link-exact-active">makefile 支持的通配符</a></li><li><a aria-current="page" href="/projects/projects/7.html#变量" class="router-link-active router-link-exact-active">变量</a></li><li><a aria-current="page" href="/projects/projects/7.html#函数" class="router-link-active router-link-exact-active">函数</a></li><li><a aria-current="page" href="/projects/projects/7.html#引入其他-makefile" class="router-link-active router-link-exact-active">引入其他 Makefile</a></li></ul></li><li><a aria-current="page" href="/projects/projects/7.html#设计makefile结构" class="router-link-active router-link-exact-active">设计Makefile结构</a></li><li><a aria-current="page" href="/projects/projects/7.html#掌握-makefile-编写技巧" class="router-link-active router-link-exact-active">掌握 Makefile 编写技巧</a><ul><li><a aria-current="page" href="/projects/projects/7.html#技巧-1-善用通配符和自动变量" class="router-link-active router-link-exact-active">技巧 1：善用通配符和自动变量</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-2-善用函数" class="router-link-active router-link-exact-active">技巧 2：善用函数</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-3-依赖需要用到的工具" class="router-link-active router-link-exact-active">技巧 3：依赖需要用到的工具</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-4-把常用功能放在-makefile-中-不常用的放在分类-makefile-中" class="router-link-active router-link-exact-active">技巧 4：把常用功能放在 /Makefile 中，不常用的放在分类 Makefile 中</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-5-编写可扩展的-makefile" class="router-link-active router-link-exact-active">技巧 5：编写可扩展的 Makefile</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-6-将所有输出存放在一个目录下-方便清理和查找" class="router-link-active router-link-exact-active">技巧 6：将所有输出存放在一个目录下，方便清理和查找</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-7-使用带层级的命名方式" class="router-link-active router-link-exact-active">技巧 7：使用带层级的命名方式</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-8-做好目标拆分" class="router-link-active router-link-exact-active">技巧 8：做好目标拆分</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-9-设置-options" class="router-link-active router-link-exact-active">技巧 9：设置 OPTIONS</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-10-定义环境变量" class="router-link-active router-link-exact-active">技巧 10：定义环境变量</a></li><li><a aria-current="page" href="/projects/projects/7.html#技巧-11-自己调用自己" class="router-link-active router-link-exact-active">技巧 11：自己调用自己</a></li></ul></li><li><a aria-current="page" href="/projects/projects/7.html#总结" class="router-link-active router-link-exact-active">总结</a></li><li><a aria-current="page" href="/projects/projects/7.html#end-链接" class="router-link-active router-link-exact-active">END 链接</a><ul><li><a aria-current="page" href="/projects/projects/7.html#links" class="router-link-active router-link-exact-active">LInks</a></li></ul></li></ul></nav><p>[TOC]</p><h2 id="低质量的makefile" tabindex="-1"><a class="header-anchor" href="#低质量的makefile" aria-hidden="true">#</a> 低质量的makefile</h2><p>低质量的 Makefile 文件是什么样的;</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>
<span class="token target symbol">build</span><span class="token punctuation">:</span> clean vet
  <span class="token operator">@</span>mkdir -p ./Role
  <span class="token operator">@</span><span class="token keyword">export</span> GOOS<span class="token operator">=</span>linux &amp;&amp; go build -v .

<span class="token target symbol">vet</span><span class="token punctuation">:</span>
  go vet ./...

<span class="token target symbol">fmt</span><span class="token punctuation">:</span>
  go fmt ./...

<span class="token target symbol">clean</span><span class="token punctuation">:</span>
  rm -rf dashboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个 Makefile 存在不少问题。例如：功能简单，只能完成最基本的编译、格式化等操作，像构建镜像、自动生成代码等一些高阶的功能都没有；扩展性差，没法编译出可在 Mac 下运行的二进制文件；没有 Help 功能，使用难度高；单 Makefile 文件，结构单一，不适合添加一些复杂的管理功能。</p><p>所以，我们不光要编写 Makefile，还要编写高质量的 Makefile。那么如何编写一个高质量的 Makefile 呢？我觉得，可以通过以下 4 个方法来实现：</p><ul><li>打好基础，也就是熟练掌握 <code>Makefile</code> 的语法。</li><li>做好准备工作，也就是提前规划 <code>Makefile</code> 要实现的功能。</li><li>进行规划，设计一个合理的 <code>Makefile</code> 结构。</li><li>掌握方法，用好 <code>Makefile</code> 的编写技巧。</li></ul><h2 id="makefile-如何工作" tabindex="-1"><a class="header-anchor" href="#makefile-如何工作" aria-hidden="true">#</a> makefile 如何工作</h2><p><img src="http://sm.nsddd.top/sm202302192223604.png" alt="image-20230219222355491"></p><p><strong>makefile规则：</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>target <span class="token punctuation">..</span>. <span class="token builtin class-name">:</span> prerequisites <span class="token punctuation">..</span>.
    <span class="token builtin class-name">command</span>
    <span class="token punctuation">..</span>.
    <span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>target</strong><ul><li>可以是一个object file（目标文件），也可以是一个执行文件，还可以是一个标签（label）。对于标签这种特性，在后续的“伪目标”章节中会有叙述。</li></ul></li><li><strong>prereqisites</strong><ul><li>生成该target所依赖的文件和/或target</li></ul></li><li><strong>command</strong><ul><li>该target要执行的命令（任意的shell命令）</li></ul></li></ul><blockquote><p>prerequisites中如果有一个以上的文件比target文件要新的话，command所定义的命令就会被执行。</p></blockquote><h3 id="build-and-run" tabindex="-1"><a class="header-anchor" href="#build-and-run" aria-hidden="true">#</a> Build and Run</h3><p><strong>首先两个特别频繁的指令加进去：</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>build: 
    go build <span class="token parameter variable">-o</span> stringifier main.go

run:
    go run <span class="token parameter variable">-race</span> main.gobuild: 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我在运行命令中添加了<code>-race</code>标志，方便它在运行时在Go代码中检测到<code>race</code>情况。</p><h3 id="cleaning-and-drying" tabindex="-1"><a class="header-anchor" href="#cleaning-and-drying" aria-hidden="true">#</a> Cleaning and DRYing</h3><p>构建二进制文件并运行应用程序后，一切正常, 确保我们在执行其他任何操作之前先清理二进制文件。我们更新<code>Makefile</code>应该看起来像这样：</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>clean<span class="token punctuation">:</span>
	<span class="token keyword">go</span> clean<span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>我们有两点可以改进</strong>:</p><ol><li>我们明确地重用了我们的应用程序名, 很自然我们的应用程序名称将在整个<code>Makefile</code>中的许多地方使用。</li><li>每次构建应用之前，我们需要先执行<code>clean</code>的规则。</li></ol><p><strong>改进后的<code>Makefile</code></strong></p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>APP<span class="token operator">=</span>stringifier

<span class="token target symbol">build</span><span class="token punctuation">:</span> clean
	go build -o <span class="token variable">$</span><span class="token punctuation">{</span>APP<span class="token punctuation">}</span> main.go

<span class="token target symbol">run</span><span class="token punctuation">:</span>
	go run -race main.go

<span class="token target symbol">clean</span><span class="token punctuation">:</span>
	go clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>更新</strong>: 这个例子之前使用的<code>rm -r ${APP}</code>，现在使用<code>go clean</code>。</p><p>在顶部定义<code>Makefile</code>变量，当您调用<code>make</code>命令时make将自动引用它们，这样<code>Makefile</code>看起来就更整洁、规范了。</p><h3 id="phony-targets" tabindex="-1"><a class="header-anchor" href="#phony-targets" aria-hidden="true">#</a> PHONY targets</h3><p>在 Makefile 中，<code>.PHONY</code> 是一个特殊的目标（target），它用于定义那些不表示实际文件的伪目标（phony target）。</p><p>当 Makefile 执行时，它会检查定义的目标是否已经存在或是否需要更新。对于伪目标，由于它们不表示任何实际文件，因此 Makefile 无法检查它们是否已经存在或是否需要更新。为了避免误判，<strong>可以使用 <code>.PHONY</code> 来明确告诉 Makefile 哪些目标是伪目标，以便在执行时跳过对这些目标的检查。</strong></p><p>例如，假设 Makefile 中定义了一个 clean 目标用于删除生成的文件，但是 clean 并不表示任何实际的文件，只是一个伪目标。那么，为了确保 Makefile 在执行时不会将 clean 当成一个文件来检查，可以在 Makefile 中添加如下声明：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> clean

<span class="token target symbol">clean</span><span class="token punctuation">:</span>
    rm -f *.o myprogram
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>这样，当执行 &quot;make clean&quot; 命令时，Makefile 会跳过对 clean 目标的文件检查，直接执行清理命令。同时，如果我们在 Makefile 中定义了一个与 clean 相同名字的文件，Makefile 也不会将其与 clean 目标混淆。因此，使用 <code>.PHONY</code> 声明伪目标可以提高 Makefile 的可读性和可靠性。</p></blockquote><p><strong>默认情况下</strong>，如果一个前置条件或是目录文件已更改，<code>make</code>将执行规则。但是由于我们不依赖于<code>make</code>来检测文件更改的能力，因此我们会遇到潜在的麻烦。</p><p>假设我们的项目目录中有一个名为 <code>build</code> 的文件, 在这个场景下，当你执行<code>make build</code>, make一定会检查文件build的更改，由于没有前置条件，因此将始终将<code>build</code>文件视为最新的，并且不会执行其规则定义的操作。</p><p>为了避免这个问题，你需要先知道<code>.PHONY</code> 特殊目录(target)是什么意思：<strong>特殊目标<code>.PHONY</code>的先决条件被视为phony目标（targets)。 当需要运行时，make会无条件运行其规则，而不管该名称的文件是否存在或其最后修改时间是多少。</strong></p><p>所以，你可以通过将目标（target）指定为特殊目标<code>.PHONY</code>的先决条件，将目标指定为<code>.PHONY</code>。</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>APP<span class="token operator">=</span>stringifier

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build
<span class="token target symbol">build</span><span class="token punctuation">:</span> clean
	go build -o <span class="token variable">$</span><span class="token punctuation">{</span>APP<span class="token punctuation">}</span> main.go

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> run
<span class="token target symbol">run</span><span class="token punctuation">:</span>
	go run -race main.go

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
	go clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在你已将上述所有的<code>targets</code>指定为<code>phony</code>, 每次你调用任何<code>phony</code>目标（target) 时，make将会执行相应的规则。你还可以一次将所有要指定为<code>phony</code>的目标指定为:</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build clean run
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>但是对于非常大的Makefile，不建议这样做因为这可能导致歧义和无法读取。因此，首选方法是在规则定义之前显式设置<code>phony</code>目标（target）。</p><h3 id="recursive-make-targets" tabindex="-1"><a class="header-anchor" href="#recursive-make-targets" aria-hidden="true">#</a> Recursive Make targets</h3><p>当 Makefile 包含多个目标时，我们可以在 Makefile 中使用递归 Make 来构建这些目标。递归 Make 指的是在 Makefile 中调用另一个 Makefile 来构建其中的目标。</p><p>在递归 Make 中，通常有一个顶层 Makefile，该 Makefile 调用其他 Makefile 来构建子目录中的目标。这样的 Makefile 被称为 &quot;递归 Makefile&quot;，而由这个 Makefile 调用的 Makefile 被称为 &quot;子 Makefile&quot;。</p><p>在递归 Make 中，每个子 Makefile 负责构建它所在的目录中的目标，然后将构建的结果返回给父 Makefile。递归 Make 的一个常见的问题是，当在子目录中调用 Make 命令时，可能会破坏父目录中的变量设置和规则，因此需要小心地设置变量和规则，以避免不必要的冲突。</p><p>递归 Make 的一种常见用法是使用一个称为“递归变量”的特殊变量。递归变量的值可以包含调用另一个 Makefile 的命令，这个命令会返回一个值，可以被递归变量使用。递归变量在递归 Make 中非常有用，因为它们可以帮助子 Makefile 获得父 Makefile 中的变量值。</p><p>例如，我们可以在项目的根目录下创建一个名为 &quot;Makefile&quot; 的文件，其内容如下：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>codeSUBDIRS <span class="token operator">=</span> foo bar baz

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> all <span class="token variable">$</span><span class="token punctuation">(</span>SUBDIRS<span class="token punctuation">)</span>

<span class="token target symbol">all</span><span class="token punctuation">:</span> <span class="token variable">$</span><span class="token punctuation">(</span>SUBDIRS<span class="token punctuation">)</span>

<span class="token target symbol"><span class="token variable">$</span>(SUBDIRS)</span><span class="token punctuation">:</span>
    <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> -C <span class="token variable">$@</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的 Makefile 中，&quot;SUBDIRS&quot; 变量定义了项目的子目录名称。&quot;all&quot; 是一个伪目标，它将调用每个子目录中的 Makefile 来构建所有目标。</p><p>$(SUBDIRS) 是一个自动变量，它会展开为 &quot;foo bar baz&quot;。因此，当我们运行 &quot;make all&quot; 命令时，它将首先调用 &quot;make foo&quot;，然后在 &quot;foo&quot; 目录中运行 &quot;make&quot; 命令来构建 &quot;foo&quot; 目录中的目标。接着它会依次调用 &quot;make bar&quot; 和 &quot;make baz&quot; 命令，以此类推。</p><p>在子目录的 Makefile 中，我们可以使用和普通 Makefile 中一样的规则和变量定义来构建子目录中的目标。这种方式可以帮助我们轻松地管理复杂的项目，避免代码重复，并提高 Makefile 的可重用性。</p><p>现在让我们假设我们在项目中使用的根目录中还有另一个模块<code>tokenizer</code>。现在我们的目录结构是这样的：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>~/programming/stringifier
<span class="token builtin class-name">.</span>
├── main.go
├── Makefile
└── tokenizer/
      ├── main.go
      └── Makefile~/programming/stringifier
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>很自然，某些时候我们也想<code>build</code>和<code>test</code>我们的<code>tokenizer</code>模块。由于它是一个独立的模块也可能是一个独立的项目，在它的目录有如下内容的一个<code>Makefile</code>是很有必要的：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token comment"># ~/programming/stringifier/tokenizer/Makefile</span>

APP<span class="token operator">=</span>tokenizer

<span class="token target symbol">build</span><span class="token punctuation">:</span>
	go build -o <span class="token variable">$</span><span class="token punctuation">{</span>APP<span class="token punctuation">}</span> main.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在只要您在<code>stringifier</code>项目的根目录中并且想要构建<code>tokenizer</code>应用程序，你不会想使用诸如<code>cd tokenizer &amp;&amp; make build &amp;&amp; cd - </code>这样的易受攻击的命令行技巧，而具体的<code>Makefiles</code>的规则写在子目录中的方式。幸运的是，<code>make</code>可以帮助你解决这个问题。你可以使用<code>-C</code>标志和特殊的<code>${NAME}</code>变量在其他目录中调用<code>make targets</code>。下面是<code>stringifies</code>项目最初的Makefile:</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token comment"># ~/programming/stringifier/Makefile</span>

APP<span class="token operator">=</span>stringifier


<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build
<span class="token target symbol">build</span><span class="token punctuation">:</span> clean
	go build -o <span class="token variable">$</span><span class="token punctuation">{</span>APP<span class="token punctuation">}</span> main.go

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> run
<span class="token target symbol">run</span><span class="token punctuation">:</span>
	go run -race main.go

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
	go clean

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build-tokenizer
<span class="token target symbol">build-tokenizer</span><span class="token punctuation">:</span>
	<span class="token variable">$</span><span class="token punctuation">{</span>MAKE<span class="token punctuation">}</span> -C tokenizer build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在只要你运行<code>make build-tokenizer</code>，<code>make</code>都将为您处理目录切换，并以更加可读和健壮的方式为您调用正确目录中的正确目标</p><p><strong><code>-c</code> 标志和特殊的 <code>${NAME}</code>:</strong></p><ol><li><p><code>-C</code> 标志：指定 Makefile 文件的目录，让 make 命令在指定的目录下执行 Makefile 文件。例如：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token target symbol">all</span><span class="token punctuation">:</span>
     cd subdir &amp;&amp; <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>上述 Makefile 中的 <code>$(MAKE)</code> 命令会在当前目录下的 <code>subdir</code> 目录中执行 Makefile 文件。可以使用 <code>-C</code> 标志来达到同样的效果：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token target symbol">all</span><span class="token punctuation">:</span>
     <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> -C subdir
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>${NAME}</code> 变量：在 Makefile 中使用 <code>${NAME}</code> 变量可以引用环境变量中的值，例如：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token target symbol">all</span><span class="token punctuation">:</span>
     echo <span class="token string">&quot;PATH is ${PATH}&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>上述 Makefile 中的 <code>${PATH}</code> 变量会展开为当前系统环境变量中的 <code>PATH</code> 值。</p></li></ol><p>以下是一个用 Go 语言编写的 Makefile 示例，其中使用了 <code>-C</code> 标志和 <code>${NAME}</code> 变量：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token comment"># Makefile</span>

APP_NAME <span class="token operator">:=</span> my-app

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build
<span class="token target symbol">build</span><span class="token punctuation">:</span>
    cd cmd/my-app &amp;&amp; go build -o ../../bin/<span class="token variable">$</span><span class="token punctuation">(</span>APP_NAME<span class="token punctuation">)</span>

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> test
<span class="token target symbol">test</span><span class="token punctuation">:</span>
    go test ./...

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
    rm -rf bin/*

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build-docker
<span class="token target symbol">build-docker</span><span class="token punctuation">:</span> build
    docker build -t <span class="token variable">$</span><span class="token punctuation">(</span>APP_NAME<span class="token punctuation">)</span> .

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> run-docker
<span class="token target symbol">run-docker</span><span class="token punctuation">:</span> build-docker
<span class="token target symbol">    docker run -p 8080</span><span class="token punctuation">:</span>8080 <span class="token variable">$</span><span class="token punctuation">(</span>APP_NAME<span class="token punctuation">)</span>

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> deploy
<span class="token target symbol">deploy</span><span class="token punctuation">:</span> build-docker
    ssh <span class="token variable">$</span><span class="token punctuation">{</span>SSH_USER<span class="token punctuation">}</span><span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">{</span>SSH_HOST<span class="token punctuation">}</span> <span class="token string">&quot;docker pull $(APP_NAME); docker stop $(APP_NAME) || true; docker rm $(APP_NAME) || true; docker run -p 8080:8080 -d --name $(APP_NAME) $(APP_NAME)&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述 Makefile 中，<code>build-docker</code>、<code>run-docker</code> 和 <code>deploy</code> 等目标中使用了 <code>${APP_NAME}</code> 变量来指定 Docker 镜像的名称，同时使用了 <code>-C</code> 标志来在子目录中执行命令，例如 <code>build</code> 目标中的 <code>cd cmd/my-app &amp;&amp; go build</code> 命令。</p><h3 id="targets-for-docker-commands" tabindex="-1"><a class="header-anchor" href="#targets-for-docker-commands" aria-hidden="true">#</a> Targets for Docker commands</h3><p>现在您希望对应用程序进行容器化，然后为方便起见编写make目标，这是完全可以理解的。</p><p>你为docker命令定义了如下规则：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> docker-build
<span class="token target symbol">docker-build</span><span class="token punctuation">:</span> build
	docker build -t stringifier .
<span class="token target symbol">	docker tag stringifier stringifier</span><span class="token punctuation">:</span>tag

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> docker-push
<span class="token target symbol">docker-push</span><span class="token punctuation">:</span> docker-build
<span class="token target symbol">	docker push gcr.io/stringifier/stringifier-staging/stringifier</span><span class="token punctuation">:</span>tag
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker命令基本满足需要，但是还有改善的空间，</p><ul><li>对于新手，你可以再次重用你的<code>${APP}</code>变量。</li><li>接下来，您想要更灵活并确保可以轻松控制将映像推送到哪里，无论是您的私人镜像仓库还是其他地方。</li><li>然后，您希望能够根据用户在命令行上的某些输入将镜像（image）分别推送到与预生产和生产环境有关的两个单独的镜像仓库中。</li><li>最后，像一个理智的开发人员一样，您想使用当前的git commit sha标记您的镜像（image）。 让我们基于这些问题重新修改下<code>Makefile</code>：</li></ul><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>APP<span class="token operator">?=</span>application
REGISTRY<span class="token operator">?=</span>gcr.io/images
COMMIT_SHA<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">shell</span> git rev-parse --short HEAD<span class="token punctuation">)</span>

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> docker-build
<span class="token target symbol">docker-build</span><span class="token punctuation">:</span> build
	docker build -t <span class="token variable">$</span><span class="token punctuation">{</span>APP<span class="token punctuation">}</span> .
<span class="token target symbol">	docker tag <span class="token variable">$</span>{APP} <span class="token variable">$</span>{APP}</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">{</span>COMMIT_SHA<span class="token punctuation">}</span>

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> docker-push
<span class="token target symbol">docker-push</span><span class="token punctuation">:</span> check-environment docker-build
<span class="token target symbol">	docker push <span class="token variable">$</span>{REGISTRY}/<span class="token variable">$</span>{ENV}/<span class="token variable">$</span>{APP}</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">{</span>COMMIT_SHA<span class="token punctuation">}</span>

<span class="token target symbol">check-environment</span><span class="token punctuation">:</span>
<span class="token keyword">ifndef</span> ENV
    <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">error</span> ENV not set, allowed values - `staging` or `production`<span class="token punctuation">)</span>
<span class="token keyword">endif</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，让我们回顾下上面的更改：</p><ul><li>你开始为应用程序名称，镜像名称,提交sha使用变量。</li><li>您使用特殊的shell函数生成了commit sha。 在这种情况下，您运行了git命令，该命令返回了简短的提交sha，并将其分配给变量<code>${COMMIT_SHA}</code>，以便稍后在Makefile中使用。</li><li>您添加了一个新的规则<code>check-environment</code>，该环境使用make条件检查在调用make时是否指定了<code>ENV</code>变量，这有助于区分预生产及生产环境。</li></ul><p><code>check-environment</code>的规则如下：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token target symbol">check-environment</span><span class="token punctuation">:</span>
<span class="token keyword">ifndef</span> ENV
    <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">error</span> ENV not set, allowed values - `staging` or `production`<span class="token punctuation">)</span>
<span class="token keyword">endif</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用<code>ifndef</code>指令检查变量ENV是否为空值，如果存在，则使用另一个make的提供内置函数，如果出错了，将会在关键字之后抛出具体的错误消息。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">make</span> docker-push
Makefile:33: *** ENV not set, allowed values - <span class="token variable"><span class="token variable">`</span>staging<span class="token variable">`</span></span> or <span class="token variable"><span class="token variable">`</span>production<span class="token variable">`</span></span><span class="token builtin class-name">.</span>  Stop.

$ <span class="token assign-left variable">ENV</span><span class="token operator">=</span>staging <span class="token function">make</span> docker-push
Success
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>本质上，您要确保docker-push目标具有安全保障，该保障可检查调用目标的用户是否已为ENV变量指定值。</p><h3 id="符号" tabindex="-1"><a class="header-anchor" href="#符号" aria-hidden="true">#</a> <code>@</code> 符号</h3><p>项目的 <code>makefile</code> 中很容易看到 <code>@</code> 符号的存在，它的意义不同寻常：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token comment">## build: Build source code for host platform.</span>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build
<span class="token target symbol">build</span><span class="token punctuation">:</span>
	<span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> go.build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在Makefile中，<code>@</code>符号用于 <strong>抑制Make命令的输出</strong>。当在Makefile中使用<code>@</code>符号时，<strong>Make将不会打印出该行命令的输出结果，而是仅仅执行该命令。</strong></p><p>在Go语言项目中，我们通常使用Makefile来构建和管理项目。下面是一个简单的Go语言项目Makefile示例：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token comment"># 编译二进制文件</span>
<span class="token target symbol">build</span><span class="token punctuation">:</span>
    <span class="token operator">@</span>go build -o myapp main.go

<span class="token comment"># 运行程序</span>
<span class="token target symbol">run</span><span class="token punctuation">:</span>
    <span class="token operator">@</span>./myapp

<span class="token comment"># 清理</span>
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
    <span class="token operator">@</span>rm -f myapp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的示例中，我们定义了三个Makefile命令：<code>build</code>，<code>run</code>和<code>clean</code>。在每个命令的前面，我们都使用了<code>@</code>符号来抑制命令的输出。这意味着，当我们在命令行中运行<code>make build</code>时，Make命令将会编译Go程序，但不会将编译器的输出打印到终端。</p><p>如果我们去掉<code>@</code>符号，那么当我们运行<code>make build</code>时，Make将会输出编译器的输出，类似于下面的结果：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>go build <span class="token parameter variable">-o</span> myapp main.go
<span class="token comment"># 输出编译器的输出</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>因此，使用<code>@</code>符号可以使Makefile输出更加干净，仅仅打印出我们关心的内容，而不会输出一堆不必要的信息。</p><h3 id="文件搜索-vpath" tabindex="-1"><a class="header-anchor" href="#文件搜索-vpath" aria-hidden="true">#</a> 文件搜索 VPATH</h3><p>在一些大的工程中，有大量的源文件，我们通常的做法是把这许多的源文件分类，并存放在不同的目录中。所以，当make需要去找寻文件的依赖关系时，你可以在文件前加上路径，但最好的方法是把一个路径告诉make，让make在自动去找。</p><p>Makefile文件中的特殊变量 <code>VPATH</code> 就是完成这个功能的，如果没有指明这个变量，make只会在当前的目录中去找寻依赖文件和目标文件。如果定义了这个变量，那么，make就会在当前目录找不到的情况下，到所指定的目录中去找寻文件了。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>VPATH <span class="token operator">=</span> src:<span class="token punctuation">..</span>/headers
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>上面的定义指定两个目录，“src”和“<code>../headers</code>”，<code>make</code>会按照这个顺序进行搜索。目录由“冒号”分隔。（当然，当前目录永远是最高优先搜索的地方）</p><p>另一个设置文件搜索路径的方法是使用make的“vpath”关键字（注意，它是全小写的），这不是变量，这是一个make的关键字，这和上面提到的那个VPATH变量很类似，但是它更为灵活。它可以指定不同的文件在不同的搜索目录中。这是一个很灵活的功能。它的使用方法有三种：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vpath &lt;pattern&gt; &lt;directories&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>为符合模式<code>&lt;pattern&gt;</code>的文件指定搜索目录<code>&lt;directories&gt;</code>。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vpath &lt;pattern&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>清除符合模式<code>&lt;pattern&gt;</code>的文件的搜索目录。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vpath
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>清除所有已被设置好了的文件搜索目录。</p><h3 id="help-target" tabindex="-1"><a class="header-anchor" href="#help-target" aria-hidden="true">#</a> Help target</h3><p>一个新成员加入了该项目并想知道Makefile中所有规则的作用，为帮助它们您可以添加一个新目标(target)，该目标将打印所有目标名称以及它们作用的简短描述:</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build
<span class="token comment">## build: build the application</span>
<span class="token target symbol">build</span><span class="token punctuation">:</span> clean
    <span class="token operator">@</span>echo <span class="token string">&quot;Building...&quot;</span>
    <span class="token operator">@</span>go build -o <span class="token variable">$</span><span class="token punctuation">{</span>APP<span class="token punctuation">}</span> main.go

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> run
<span class="token comment">## run: runs go run main.go</span>
<span class="token target symbol">run</span><span class="token punctuation">:</span>
	go run -race main.go

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token comment">## clean: cleans the binary</span>
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
    <span class="token operator">@</span>echo <span class="token string">&quot;Cleaning&quot;</span>
    <span class="token operator">@</span>go clean

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> setup
<span class="token comment">## setup: setup go modules</span>
<span class="token target symbol">setup</span><span class="token punctuation">:</span>
	<span class="token operator">@</span>go mod init \
		&amp;&amp; go mod tidy \
		&amp;&amp; go mod vendor
	
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> help
<span class="token comment">## help: prints this help message</span>
<span class="token target symbol">help</span><span class="token punctuation">:</span>
	<span class="token operator">@</span>echo <span class="token string">&quot;Usage: \n&quot;</span>
	<span class="token operator">@</span>sed -n <span class="token string">&#39;s/^##//p&#39;</span> <span class="token variable">$</span><span class="token punctuation">{</span>MAKEFILE_LIST<span class="token punctuation">}</span> <span class="token operator">|</span> column -t -s <span class="token string">&#39;:&#39;</span> <span class="token operator">|</span>  sed -e <span class="token string">&#39;s/^/ /&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你先注意下最后一条规则，<code>help</code> 在这里，您只是使用一些sed魔术来解析和在命令行上打印。 但是要做到这一点，您必要在每条规则之前写了目标名称和简短描述作为注释。 注意另一个特殊变量<code>$ {MAKEFILE_LIST}</code>，它是您所引用的所有Makefile的列表，在本例中仅是Makefile。</p><p>您会将文件Makefile作为输入传递给sed命令，该命令将解析所有帮助注释并以表格格式将其打印到stdout，以便于阅读。 上一个代码段的<code>help</code>目标的输出如下所示：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">make</span> <span class="token builtin class-name">help</span>
Usage:
	build             Build the application
	clean             cleans the binary
	run               runs go run main.go
	docker-build      builds <span class="token function">docker</span> image
	docker-push       pushes the <span class="token function">docker</span> image
	setup             <span class="token builtin class-name">set</span> up modules
	<span class="token builtin class-name">help</span>              prints this <span class="token builtin class-name">help</span> message
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些消息很有帮助，对于其他人甚至有时对自己都是一个不错的提示。</p><h3 id="conclusion-结论" tabindex="-1"><a class="header-anchor" href="#conclusion-结论" aria-hidden="true">#</a> Conclusion 结论</h3><p>Make是一个简单但可高度配置的工具。 在本文中，您遍历了make提供的许多配置和功能，从而为Go应用程序编写了有效而高效的Makefile。</p><p>下面是完整的Makefile，其中添加了一些琐碎的规则和变量：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>GO111MODULES<span class="token operator">=</span>on
APP<span class="token operator">?=</span>stringifier
REGISTRY<span class="token operator">?=</span>gcr.io/images
COMMIT_SHA<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">shell</span> git rev-parse --short HEAD<span class="token punctuation">)</span>



<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build
<span class="token comment">## build: build the application</span>
<span class="token target symbol">build</span><span class="token punctuation">:</span> clean
    <span class="token operator">@</span>echo <span class="token string">&quot;Building...&quot;</span>
    <span class="token operator">@</span>go build -o <span class="token variable">$</span><span class="token punctuation">{</span>APP<span class="token punctuation">}</span> main.go

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> run
<span class="token comment">## run: runs go run main.go</span>
<span class="token target symbol">run</span><span class="token punctuation">:</span>
	go run -race main.go

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token comment">## clean: cleans the binary</span>
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
    <span class="token operator">@</span>echo <span class="token string">&quot;Cleaning&quot;</span>
    <span class="token operator">@</span>go clean

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> test
<span class="token comment">## test: runs go test with default values</span>
<span class="token target symbol">test</span><span class="token punctuation">:</span>
	go test -v -count<span class="token operator">=</span>1 -race ./...


<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build-tokenizer
<span class="token comment">## build-tokenizer: build the tokenizer application</span>
<span class="token target symbol">build-tokenizer</span><span class="token punctuation">:</span>
	<span class="token variable">$</span><span class="token punctuation">{</span>MAKE<span class="token punctuation">}</span> -c tokenizer build

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> setup
<span class="token comment">## setup: setup go modules</span>
<span class="token target symbol">setup</span><span class="token punctuation">:</span>
	<span class="token operator">@</span>go mod init \
		&amp;&amp; go mod tidy \
		&amp;&amp; go mod vendor
	
<span class="token comment"># helper rule for deployment</span>
<span class="token target symbol">check-environment</span><span class="token punctuation">:</span>
<span class="token keyword">ifndef</span> ENV
    <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">error</span> ENV not set, allowed values - `staging` or `production`<span class="token punctuation">)</span>
<span class="token keyword">endif</span>

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> docker-build
<span class="token comment">## docker-build: builds the stringifier docker image to registry</span>
<span class="token target symbol">docker-build</span><span class="token punctuation">:</span> build
<span class="token target symbol">	docker build -t <span class="token variable">$</span>{APP}</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">{</span>COMMIT_SHA<span class="token punctuation">}</span> .

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> docker-push
<span class="token comment">## docker-push: pushes the stringifier docker image to registry</span>
<span class="token target symbol">docker-push</span><span class="token punctuation">:</span> check-environment docker-build
<span class="token target symbol">	docker push <span class="token variable">$</span>{REGISTRY}/<span class="token variable">$</span>{ENV}/<span class="token variable">$</span>{APP}</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">{</span>COMMIT_SHA<span class="token punctuation">}</span>

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> help
<span class="token comment">## help: Prints this help message</span>
<span class="token target symbol">help</span><span class="token punctuation">:</span>
	<span class="token operator">@</span>echo <span class="token string">&quot;Usage: \n&quot;</span>
	<span class="token operator">@</span>sed -n <span class="token string">&#39;s/^##//p&#39;</span> <span class="token variable">$</span><span class="token punctuation">{</span>MAKEFILE_LIST<span class="token punctuation">}</span> <span class="token operator">|</span> column -t -s <span class="token string">&#39;:&#39;</span> <span class="token operator">|</span>  sed -e <span class="token string">&#39;s/^/ /&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="熟练makefile语法" tabindex="-1"><a class="header-anchor" href="#熟练makefile语法" aria-hidden="true">#</a> 熟练makefile语法</h2><p><strong>IAM 项目的 Makefile 文件：</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">make</span> <span class="token builtin class-name">help</span>

Usage: <span class="token function">make</span> <span class="token operator">&lt;</span>TARGETS<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>OPTIONS<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.

Targets:
  <span class="token comment"># 代码生成类命令</span>
  gen                Generate all necessary files, such as error code files.

  <span class="token comment"># 格式化类命令</span>
  <span class="token function">format</span>             Gofmt <span class="token punctuation">(</span>reformat<span class="token punctuation">)</span> package sources <span class="token punctuation">(</span>exclude vendor <span class="token function">dir</span> <span class="token keyword">if</span> existed<span class="token punctuation">)</span>.

  <span class="token comment"># 静态代码检查</span>
  lint               Check syntax and styling of go sources.

  <span class="token comment"># 测试类命令</span>
  <span class="token builtin class-name">test</span>               Run unit test.
  cover              Run unit <span class="token builtin class-name">test</span> and get <span class="token builtin class-name">test</span> coverage.

  <span class="token comment"># 构建类命令</span>
  build              Build <span class="token builtin class-name">source</span> code <span class="token keyword">for</span> <span class="token function">host</span> platform.
  build.multiarch    Build <span class="token builtin class-name">source</span> code <span class="token keyword">for</span> multiple platforms. See option PLATFORMS.

  <span class="token comment"># Docker镜像打包类命令</span>
  image              Build <span class="token function">docker</span> images <span class="token keyword">for</span> <span class="token function">host</span> arch.
  image.multiarch    Build <span class="token function">docker</span> images <span class="token keyword">for</span> multiple platforms. See option PLATFORMS.
  push               Build <span class="token function">docker</span> images <span class="token keyword">for</span> <span class="token function">host</span> arch and push images to registry.
  push.multiarch     Build <span class="token function">docker</span> images <span class="token keyword">for</span> multiple platforms and push images to registry.

  <span class="token comment"># 部署类命令</span>
  deploy             Deploy updated components to development env.

  <span class="token comment"># 清理类命令</span>
  clean              Remove all files that are created by building.

  <span class="token comment"># 其他命令，不同项目会有区别</span>
  release            Release iam
  verify-copyright   Verify the boilerplate headers <span class="token keyword">for</span> all files.
  ca                 Generate CA files <span class="token keyword">for</span> all iam components.
  <span class="token function">install</span>            Install iam system with all its components.
  swagger            Generate swagger document.
  tools              <span class="token function">install</span> dependent tools.

  <span class="token comment"># 帮助命令</span>
  <span class="token builtin class-name">help</span>               Show this <span class="token builtin class-name">help</span> info.

<span class="token comment"># 选项</span>
Options:
  DEBUG        Whether to generate debug symbols. Default is <span class="token number">0</span>.
  BINS         The binaries to build. Default is all of cmd.
               This option is available when using: <span class="token function">make</span> build/build.multiarch
               Example: <span class="token function">make</span> build <span class="token assign-left variable">BINS</span><span class="token operator">=</span><span class="token string">&quot;iam-apiserver iam-authz-server&quot;</span>
  <span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常而言，Go 项目的 Makefile 应该实现以下功能：格式化代码、静态代码检查、单元测试、代码构建、文件清理、帮助等等。如果通过 docker 部署，还需要有 docker 镜像打包功能。因为 Go 是跨平台的语言，所以构建和 docker 打包命令，还要能够支持不同的 CPU 架构和平台。为了能够更好地控制 Makefile 命令的行为，还需要支持 Options。</p><p><strong>为了方便查看 Makefile 集成了哪些功能，我们需要支持 help 命令。help 命令最好通过解析 Makefile 文件来输出集成的功能，例如：</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## help: Show this help info.</span>
.PHONY: <span class="token builtin class-name">help</span>
help: Makefile
  @echo <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token entity" title="\n">\n</span>Usage: make &lt;TARGETS&gt; &lt;OPTIONS&gt; ...<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>Targets:&quot;</span>
  @sed <span class="token parameter variable">-n</span> <span class="token string">&#39;s/^##//p&#39;</span> $<span class="token operator">&lt;</span> <span class="token operator">|</span> <span class="token function">column</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-s</span> <span class="token string">&#39;:&#39;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/^/ /&#39;</span>
  @echo <span class="token string">&quot;<span class="token variable">$$</span>USAGE_OPTIONS&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的 help 命令，通过解析 Makefile 文件中的 <code>##</code> 注释，获取支持的命令。通过这种方式，我们以后新加命令时，就不用再对 help 命令进行修改了。</p><h3 id="常用的-makefile-核心语法" tabindex="-1"><a class="header-anchor" href="#常用的-makefile-核心语法" aria-hidden="true">#</a> 常用的 Makefile 核心语法</h3><p>大多数的 make 都支持“makefile”和“Makefile”这两种文件名，但我建议使用“Makefile”。因为这个文件名第一个字符大写，会很明显，容易辨别。make 也支持 <code>-f</code> 和 <code>--file</code> 参数来指定其他文件名，比如 <code>make -f golang.mk</code> 或者 <code>make --file golang.mk</code> 。</p><h3 id="makefile-支持的通配符" tabindex="-1"><a class="header-anchor" href="#makefile-支持的通配符" aria-hidden="true">#</a> makefile 支持的通配符</h3><p>Makefile 支持三种类型的通配符，他们是：<code>*，? 和~</code></p><ol><li><strong><code>*</code>通配符：</strong></li></ol><p>*通配符代表任意长度的字符序列，可以匹配任意长度的文件名或路径名中的任意字符。例如，可以使用以下规则来匹配所有.c文件：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>SRCS <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> *.c<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这条规则将会将当前目录下所有以<code>.c</code>为后缀的文件名赋值给变量SRCS，使得我们可以方便地引用这些文件。</p><ol start="2"><li><strong><code>?</code>通配符：</strong></li></ol><p>?通配符代表任意单个字符，可以匹配任意长度的文件名或路径名中的一个字符。例如，可以使用以下规则来匹配所有三个字符长的<code>.txt</code>文件：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>SRCS <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> ???.txt<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这条规则将会将当前目录下所有文件名长度为3，并以.txt为后缀的文件名赋值给变量SRCS。</p><ol start="3"><li><strong><code>~</code>通配符：</strong></li></ol><p>~通配符代表当前用户的<code>home</code>目录，可以用来指定文件路径。例如，可以使用以下规则来指定当前用户的<code>home</code>目录：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable"><span class="token variable">$(</span><span class="token environment constant">HOME</span><span class="token variable">)</span></span>/myprogram
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这条规则将会将当前用户的home目录路径和myprogram字符串拼接起来，从而得到一个完整的路径名，使得我们可以方便地引用home目录下的文件或路径。</p><h3 id="变量" tabindex="-1"><a class="header-anchor" href="#变量" aria-hidden="true">#</a> 变量</h3><p>变量，可能是 Makefile 中使用最频繁的语法了，Makefile 支持变量赋值、多行变量和环境变量。另外，Makefile 还内置了一些特殊变量和自动化变量。</p><p><strong>变量赋值 ：</strong></p><p>Makefile 也可以像其他语言一样支持变量。在使用变量时，会像 shell 变量一样原地展开，然后再执行替换后的内容。</p><p>Makefile 可以通过变量声明来声明一个变量，变量在声明时需要赋予一个初值，比如<code>ROOT_PACKAGE=github.com/marmotedu/iam</code>。</p><p>引用变量时可以通过<code>$()</code>或者<code>${}</code>方式引用。我的建议是，用<code>$()</code>方式引用变量，例如<code>$(ROOT_PACKAGE)</code>，也建议整个 makefile 的变量引用方式保持一致。</p><p>变量会像 bash 变量一样，在使用它的地方展开。比如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">GO</span><span class="token operator">=</span>go
build:
    <span class="token variable"><span class="token variable">$(</span>GO<span class="token variable">)</span></span> build <span class="token parameter variable">-v</span> <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>展开后为：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">GO</span><span class="token operator">=</span>go
build:
    go build <span class="token parameter variable">-v</span> <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Makefile 有四种的赋值方式：</strong></p><p><strong><code>=</code> 最基本的赋值方法。</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>BASE_IMAGE <span class="token operator">=</span> alpine:3.10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>💡 注意：使用 <code>=</code> 赋值的时候，取值到的并非是程序依次执行的值，而是最终的值</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>A <span class="token operator">=</span> a
B <span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>A<span class="token variable">)</span></span> b
A <span class="token operator">=</span> c
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>B 最后的值为 c b，而不是 a b。也就是说，在用变量给变量赋值时，右边变量的取值，取的是最终的变量值。</p></blockquote><p><strong>和go一样，<code>:=</code>直接赋值，赋予当前位置的值。</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>A <span class="token operator">=</span> a
B :<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>A<span class="token variable">)</span></span> b
A <span class="token operator">=</span> c
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>B 最后的值为 a b。通过 <code>:=</code> 的赋值方式，可以避免 <code>=</code> 赋值带来的潜在的不一致。</p><p><strong><code>?=</code> 表示如果该变量没有被赋值，则赋予等号后的值。</strong></p><p><strong>例如：</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>PLATFORMS ?<span class="token operator">=</span> linux_amd64 linux_arm64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong><code>+=</code>表示将等号后面的值添加到前面的变量上。</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>MAKEFLAGS += --no-print-directory
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Makefile 还支持多行变量。可以通过 define 关键字设置多行变量，变量中允许换行。定义方式为：</strong></p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">define</span> 变量名
变量内容
...
<span class="token keyword">endef</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>变量的内容可以包含函数、命令、文字或是其他变量。例如，我们可以定义一个 <code>USAGE_OPTIONS</code> 变量：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">define</span> USAGE_OPTIONS

<span class="token target symbol">Options</span><span class="token punctuation">:</span>
  DEBUG        Whether to generate debug symbols. Default is 0.
  BINS         The binaries to build. Default is all of cmd.
  ...
  V            Set to 1 enable verbose build. Default is 0.
<span class="token keyword">endef</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Makefile 还支持环境变量。在 Makefile 中，有两种环境变量，分别是 Makefile 预定义的环境变量和自定义的环境变量。</p><p>其中，自定义的环境变量可以覆盖 Makefile 预定义的环境变量。默认情况下，Makefile 中定义的环境变量只在当前 Makefile 有效，如果想向下层传递（Makefile 中调用另一个 Makefile），需要使用 export 关键字来声明。</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>...
<span class="token keyword">export</span> USAGE_OPTIONS
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此外，Makefile 还支持两种内置的变量：特殊变量和自动化变量。</p><p>特殊变量是 make 提前定义好的，可以在 makefile 中直接引用。特殊变量列表如下：</p><p><img src="http://sm.nsddd.top/sm202302201636940.png" alt="image-20230220163605753"></p><p>Makefile 还支持自动化变量。自动化变量可以提高我们编写 Makefile 的效率和质量。</p><p><strong>自动化变量：</strong></p><p>这时就可以用到自动化变量。所谓自动化变量，就是这种变量会把模式中所定义的一系列的文件自动地挨个取出，一直到所有符合模式的文件都取完为止。这种自动化变量只应出现在规则的命令中。Makefile 中支持的自动化变量见下表。</p><p><img src="http://sm.nsddd.top/sm202303181839805.png" alt="image-20230220163723550"></p><p>上面这些自动化变量中，<code>$*</code>是用得最多的。<code>$*</code> 对于构造有关联的文件名是比较有效的。如果目标中没有模式的定义，那么 <code>$*</code> 也就不能被推导出。但是，如果目标文件的后缀是 make 所识别的，那么 <code>$*</code> 就是除了后缀的那一部分。例如：如果目标是 <code>foo.c</code> ，因为.c 是 make 所能识别的后缀名，所以 <code>$*</code> 的值就是 foo。</p><p><strong>条件语句：</strong></p><p>Makefile 也支持条件语句。这里先看一个示例。</p><p>下面的例子判断变量ROOT_PACKAGE是否为空，如果为空，则输出错误信息，不为空则打印变量值：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">ifeq</span> <span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span>ROOT_PACKAGE<span class="token punctuation">)</span>,<span class="token punctuation">)</span>
<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">error</span> the variable ROOT_PACKAGE must be set prior to including golang.mk<span class="token punctuation">)</span>
<span class="token keyword">else</span>
<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">info</span> the value of ROOT_PACKAGE is <span class="token variable">$</span><span class="token punctuation">(</span>ROOT_PACKAGE<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>条件语句的语法为：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>
<span class="token comment"># if ...</span>
&lt;conditional-directive&gt;
&lt;text-if-true&gt;
<span class="token keyword">endif</span>
<span class="token comment"># if ... else ...</span>
&lt;conditional-directive&gt;
&lt;text-if-true&gt;
<span class="token keyword">else</span>
&lt;text-if-false&gt;
<span class="token keyword">endif</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例如，判断两个值是否相等：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>
<span class="token keyword">ifeq</span> 条件表达式
...
<span class="token keyword">else</span>
...
<span class="token keyword">endif</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ifeq 表示条件语句的开始，并指定一个条件表达式。表达式包含两个参数，参数之间用逗号分隔，并且表达式用圆括号括起来。</li><li>else 表示条件表达式为假的情况。</li><li>endif 表示一个条件语句的结束，任何一个条件表达式都应该以 endif 结束。</li><li>表示条件关键字，有 4 个关键字：ifeq、ifneq、ifdef、ifndef。</li></ul><p><strong>为了加深你的理解，我们分别来看下这 4 个关键字的例子。</strong></p><p>ifeq：条件判断，判断是否相等。</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">ifeq</span> <span class="token punctuation">(</span>&lt;arg1&gt;, &lt;arg2&gt;<span class="token punctuation">)</span>
<span class="token keyword">ifeq</span> <span class="token string">&#39;&lt;arg1&gt;&#39;</span> <span class="token string">&#39;&lt;arg2&gt;&#39;</span>
<span class="token keyword">ifeq</span> <span class="token string">&quot;&lt;arg1&gt;&quot;</span> <span class="token string">&quot;&lt;arg2&gt;&quot;</span>
<span class="token keyword">ifeq</span> <span class="token string">&quot;&lt;arg1&gt;&quot;</span> <span class="token string">&#39;&lt;arg2&gt;&#39;</span>
<span class="token keyword">ifeq</span> <span class="token string">&#39;&lt;arg1&gt;&#39;</span> <span class="token string">&quot;&lt;arg2&gt;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比较 arg1 和 arg2 的值是否相同，如果相同则为真。也可以用 make 函数 / 变量替代 arg1 或 arg2，例如 <code>ifeq ($(origin ROOT_DIR),undefined) </code>或 <code>ifeq ($(ROOT_PACKAGE),)</code> 。origin 函数会在之后专门讲函数的一讲中介绍到。</p><p>ifneq：条件判断，判断是否不相等。</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">ifneq</span> <span class="token punctuation">(</span>&lt;arg1&gt;, &lt;arg2&gt;<span class="token punctuation">)</span>
<span class="token keyword">ifneq</span> <span class="token string">&#39;&lt;arg1&gt;&#39;</span> <span class="token string">&#39;&lt;arg2&gt;&#39;</span>
<span class="token keyword">ifneq</span> <span class="token string">&quot;&lt;arg1&gt;&quot;</span> <span class="token string">&quot;&lt;arg2&gt;&quot;</span>
<span class="token keyword">ifneq</span> <span class="token string">&quot;&lt;arg1&gt;&quot;</span> <span class="token string">&#39;&lt;arg2&gt;&#39;</span>
<span class="token keyword">ifneq</span> <span class="token string">&#39;&lt;arg1&gt;&#39;</span> <span class="token string">&quot;&lt;arg2&gt;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比较 arg1 和 arg2 的值是否不同，如果不同则为真。</p><p>ifdef：条件判断，判断变量是否已定义。</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">ifdef</span> &lt;variable-name&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果值非空，则表达式为真，否则为假。也可以是函数的返回值。</p><p>ifndef：条件判断，判断变量是否未定义。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ifndef &lt;variable-name&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果值为空，则表达式为真，否则为假。也可以是函数的返回值。</p><h3 id="函数" tabindex="-1"><a class="header-anchor" href="#函数" aria-hidden="true">#</a> 函数</h3><p>我们先来看下自定义函数。 make 解释器提供了一系列的函数供 Makefile 调用，这些函数是 Makefile 的预定义函数。我们可以通过 define 关键字来自定义一个函数。自定义函数的语法为：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">define</span> 函数名
函数体
<span class="token keyword">endef</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>💡简单的一个案例如下：</strong></p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">define</span> Foo
    <span class="token operator">@</span>echo <span class="token string">&quot;my name is $(0)&quot;</span>
    <span class="token operator">@</span>echo <span class="token string">&quot;param is $(1)&quot;</span>
<span class="token keyword">endef</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>define 本质上是定义一个多行变量，可以在 call 的作用下当作函数来使用，在其他位置使用只能作为多行变量来使用，例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>var :<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>call Foo<span class="token variable">)</span></span>
new :<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>Foo<span class="token variable">)</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>预定义函数：</strong></p><p>再来看下预定义函数。 刚才提到，make 编译器也定义了很多函数，这些函数叫作预定义函数，调用语法和变量类似，语法为：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$(&lt;function&gt; &lt;arguments&gt;)
OR
${&lt;function&gt; &lt;arguments&gt;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>&lt;function&gt; </code> 是函数名，<code>&lt;arguments&gt;</code> 是函数参数，参数间用逗号分割。函数的参数也可以是变量。</p><p>💡简单的一个案例如下：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>PLATFORM <span class="token operator">=</span> linux_amd64
GOOS <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 1, <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> _, ,<span class="token variable">$</span><span class="token punctuation">(</span>PLATFORM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的例子用到了两个函数：word 和 subst。word 函数有两个参数，1 和 subst 函数的输出。subst 函数将 PLATFORM 变量值中的 <code>_</code> 替换成空格（替换后的 PLATFORM 值为 linux amd64）。word 函数取 linux amd64 字符串中的第一个单词。所以最后 GOOS 的值为 linux。</p><p>Makefile 预定义函数能够帮助我们实现很多强大的功能，在编写 Makefile 的过程中，如果有功能需求，可以优先使用这些函数。如果你想使用这些函数，那就需要知道有哪些函数，以及它们实现的功能。</p><p><img src="http://sm.nsddd.top/sm202302201721492.jpeg" alt="img"></p><h3 id="引入其他-makefile" tabindex="-1"><a class="header-anchor" href="#引入其他-makefile" aria-hidden="true">#</a> 引入其他 Makefile</h3><p>在 Makefile 中，我们可以通过关键字 include，把别的 makefile 包含进来，类似于 C 语言的#include，被包含的文件会插入在当前的位置。include 用法为include ，示例如下：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">include</span> scripts/make-rules/common.mk
<span class="token keyword">include</span> scripts/make-rules/golang.mk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>include 也可以包含通配符include scripts/make-rules/*。make 命令会按下面的顺序查找 makefile 文件：</p><ul><li>如果是绝对或相对路径，就直接根据路径 include 进来。</li><li>如果 make 执行时，有<code>-I</code>或<code>--include-dir</code>参数，那么 make 就会在这个参数所指定的目录下去找。</li><li>如果目录<code>&lt;prefix&gt;/include</code>（一般是/usr/local/bin或/usr/include）存在的话，make 也会去找。</li></ul><p>如果有文件没有找到，make 会生成一条警告信息，但不会马上出现致命错误，而是继续载入其他的文件。一旦完成 makefile 的读取，make 会再重试这些没有找到或是不能读取的文件。如果还是不行，make 才会出现一条致命错误信息。如果你想让 <code>make</code> 忽略那些无法读取的文件继续执行，可以在 i<code>n</code>clude 前加一个减号<code>-</code>，如<code>-include</code> 。</p><h2 id="设计makefile结构" tabindex="-1"><a class="header-anchor" href="#设计makefile结构" aria-hidden="true">#</a> 设计Makefile结构</h2><p>对于大型项目来说，需要管理的内容很多，所有管理功能都集成在一个 Makefile 中，可能会导致 Makefile 很大，难以阅读和维护，所以建议采用分层的设计方法，<strong>根目录下的 Makefile 聚合所有的 Makefile 命令，具体实现则按功能分类，放在另外的 Makefile 中。</strong></p><p>我们经常会在 Makefile 命令中集成 shell 脚本，但如果 shell 脚本过于复杂，也会导致 Makefile 内容过多，难以阅读和维护。并且在 Makefile 中集成复杂的 shell 脚本，编写体验也很差。对于这种情况，<strong>可以将复杂的 shell 命令封装在 shell 脚本中，供 Makefile 直接调用，而一些简单的命令则可以直接集成在 Makefile 中。</strong></p><p><strong>推荐的 Makefile 结构：</strong></p><p><img src="https://sm.nsddd.top/sm202302191533699.png" alt="image-20230219153332640"></p><p>在上面的 Makefile 组织方式中，根目录下的 Makefile 聚合了项目所有的管理功能，这些管理功能通过 Makefile 伪目标的方式实现。同时，还将这些伪目标进行分类，把相同类别的伪目标放在同一个 Makefile 中，这样可以使得 Makefile 更容易维护。对于复杂的命令，则编写成独立的 shell 脚本，并在 Makefile 命令中调用这些 shell 脚本。</p><p>举个例子，下面是 IAM 项目的 Makefile 组织结构：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>
├── Makefile
├── scripts
│   ├── gendoc.sh
│   ├── make-rules
│   │   ├── gen.mk
│   │   ├── golang.mk
│   │   ├── image.mk
│   │   └── <span class="token punctuation">..</span>.
    └── <span class="token punctuation">..</span>.
├── Makefile
├── scripts
│   ├── gendoc.sh
│   ├── make-rules
│   │   ├── gen.mk
│   │   ├── golang.mk
│   │   ├── image.mk
│   │   └── <span class="token punctuation">..</span>.
    └── <span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们将相同类别的操作统一放在 <code>scripts/make-rules</code> 目录下的 Makefile 文件中。<strong>Makefile 的文件名参考分类命名</strong>，例如 <code>golang.mk</code>。最后，在 <code>/Makefile</code> 中 include 这些 Makefile。</p><blockquote><p>需要使用 <code>include</code> 来获取头文件：</p><p><code>include</code>是一种指令，用于将另一个文件中的规则和变量导入到当前的makefile中。这样做可以让你的makefile更加模块化，易于维护和重用。</p><p><strong>注意和我们上面讲的模块化分配 Makefile 层级调用有些不一样。</strong></p><p>下面是一个include的案例，假设我们有一个名为<code>main.c</code>的源文件，它需要链接一个名为<code>libfoo.a</code>的静态库文件。我们可以将这些规则和变量定义在一个名为<code>Makefile.inc</code>的文件中，然后在我们的主makefile中使用include指令将其导入。</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>CC <span class="token operator">=</span> gcc
CFLAGS <span class="token operator">=</span> -Wall -Werror -g

<span class="token target symbol">all</span><span class="token punctuation">:</span> libfoo.a

<span class="token target symbol">libfoo.a</span><span class="token punctuation">:</span> foo.o
	ar rcs <span class="token variable">$@</span> <span class="token variable">$^</span>

<span class="token target symbol">foo.o</span><span class="token punctuation">:</span> foo.c foo.h
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -c <span class="token variable">$&lt;</span>

<span class="token target symbol">clean</span><span class="token punctuation">:</span>
	rm -f *.o libfoo.a

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主makefile文件：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">include</span> Makefile.inc

<span class="token target symbol">main</span><span class="token punctuation">:</span> main.c libfoo.a
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -o <span class="token variable">$@</span> <span class="token variable">$&lt;</span> -L. -lfoo

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> -C . -f Makefile.inc clean
	rm -f main
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>go 语言Makefile 💡简单的一个案例如下：</strong></p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token comment"># 定义变量</span>
GOCMD<span class="token operator">=</span>go
GOBUILD<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>GOCMD<span class="token punctuation">)</span> build
GOCLEAN<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>GOCMD<span class="token punctuation">)</span> clean
BINARY_NAME<span class="token operator">=</span>myapp
BINARY_UNIX<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>BINARY_NAME<span class="token punctuation">)</span>_unix

<span class="token target symbol">all</span><span class="token punctuation">:</span> deps build
<span class="token target symbol">build</span><span class="token punctuation">:</span>
    <span class="token variable">$</span><span class="token punctuation">(</span>GOBUILD<span class="token punctuation">)</span> -o <span class="token variable">$</span><span class="token punctuation">(</span>BINARY_NAME<span class="token punctuation">)</span> -v
    <span class="token variable">$</span><span class="token punctuation">(</span>GOBUILD<span class="token punctuation">)</span> -o <span class="token variable">$</span><span class="token punctuation">(</span>BINARY_UNIX<span class="token punctuation">)</span> -v
<span class="token target symbol">deps</span><span class="token punctuation">:</span>
    <span class="token variable">$</span><span class="token punctuation">(</span>GOCMD<span class="token punctuation">)</span> get -u github.com/golang/dep/cmd/dep
    dep ensure
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
    <span class="token variable">$</span><span class="token punctuation">(</span>GOCLEAN<span class="token punctuation">)</span>
    rm -f <span class="token variable">$</span><span class="token punctuation">(</span>BINARY_NAME<span class="token punctuation">)</span>
    rm -f <span class="token variable">$</span><span class="token punctuation">(</span>BINARY_UNIX<span class="token punctuation">)</span>
<span class="token target symbol">run</span><span class="token punctuation">:</span>
    <span class="token variable">$</span><span class="token punctuation">(</span>GOBUILD<span class="token punctuation">)</span> -o <span class="token variable">$</span><span class="token punctuation">(</span>BINARY_NAME<span class="token punctuation">)</span> -v ./...
    ./<span class="token variable">$</span><span class="token punctuation">(</span>BINARY_NAME<span class="token punctuation">)</span>
<span class="token keyword">include</span> docker.mk

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的示例中，最后一行 <code>include docker.mk</code> 引用了名为 <code>docker.mk</code> 的 Makefile 文件。这个文件中可能包含了一些 Docker 相关的命令，比如构建镜像、推送镜像等等。通过 include 指令，这些命令可以被自动引入到主 Makefile 文件中，从而实现更加高效和便捷的编译和构建。</p><p>需要注意的是，include 指令的作用是将被引入的 Makefile 文件的内容直接复制到主 Makefile 文件中。因此，如果引入的文件中定义了和主 Makefile 文件中相同的变量或者规则，会发生命名冲突。因此，在编写被引入的 Makefile 文件时，应该避免使用和主 Makefile 文件相同的变量和规则名。</p></blockquote><p>为了跟 Makefile 的层级相匹配，<code>golang.mk</code> 中的所有目标都按<code>go.xxx</code>这种方式命名。通过这种命名方式，我们可以很容易分辨出某个目标完成什么功能，放在什么文件里，这在复杂的 Makefile 中尤其有用。以下是 IAM 项目根目录下，Makefile 的内容摘录，你可以看一看，作为参考：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">include</span> scripts/make-rules/golang.mk
<span class="token keyword">include</span> scripts/make-rules/image.mk
<span class="token keyword">include</span> scripts/make-rules/gen.mk
<span class="token keyword">include</span> scripts/make-rules/...

<span class="token comment">## build: Build source code for host platform.</span>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build
<span class="token target symbol">build</span><span class="token punctuation">:</span>
  <span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> go.build

<span class="token comment">## build.multiarch: Build source code for multiple platforms. See option PLATFORMS.</span>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> build.multiarch
<span class="token target symbol">build.multiarch</span><span class="token punctuation">:</span>
  <span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> go.build.multiarch

<span class="token comment">## image: Build docker images for host arch.</span>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> image
<span class="token target symbol">image</span><span class="token punctuation">:</span>
  <span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> image.build

<span class="token comment">## push: Build docker images for host arch and push images to registry.</span>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> push
<span class="token target symbol">push</span><span class="token punctuation">:</span>
  <span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> image.push

<span class="token comment">## ca: Generate CA files for all iam components.</span>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> ca
<span class="token target symbol">ca</span><span class="token punctuation">:</span>
  <span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> gen.ca
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，一个合理的 Makefile 结构应该具有前瞻性。也就是说，要在不改变现有结构的情况下，接纳后面的新功能。这就需要你整理好 Makefile 当前要实现的功能、即将要实现的功能和未来可能会实现的功能，然后基于这些功能，利用 Makefile 编程技巧，编写可扩展的 Makefile。</p><p>这里需要你注意：上面的 Makefile 通过 <code>.PHONY</code> 标识定义了大量的伪目标，定义伪目标一定要加 <code>.PHONY</code> 标识，否则当有同名的文件时，伪目标可能不会被执行。</p><h2 id="掌握-makefile-编写技巧" tabindex="-1"><a class="header-anchor" href="#掌握-makefile-编写技巧" aria-hidden="true">#</a> 掌握 Makefile 编写技巧</h2><h3 id="技巧-1-善用通配符和自动变量" tabindex="-1"><a class="header-anchor" href="#技巧-1-善用通配符和自动变量" aria-hidden="true">#</a> 技巧 1：善用通配符和自动变量</h3><p>Makefile 允许对目标进行类似正则运算的匹配，主要用到的通配符是%。通过使用通配符，可以使不同的目标使用相同的规则，从而使 Makefile 扩展性更强，也更简洁。</p><p>我们的 IAM 实战项目中，就大量使用了通配符<code>%</code>，例如：<code>go.build.%</code>、<code>ca.gen.%</code>、<code>deploy.run.%</code>、<code>tools.verify.%</code>、<code>tools.install.%</code>等。</p><p>这里，我们来看一个具体的例子，<code>tools.verify.%</code>（位于<code>scripts/make-rules/tools.mk</code>文件中）定义如下：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token target symbol">tools.verify.%</span><span class="token punctuation">:</span>
  <span class="token operator">@</span>if ! which <span class="token variable">$*</span> &amp;&gt;/dev/null<span class="token punctuation">;</span> then <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> tools.install.<span class="token variable">$*;</span> fi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>make tools.verify.swagger</code>, <code>make tools.verify.mockgen</code>等均可以使用上面定义的规则，%分别代表了<code>swagger</code>和<code>mockgen</code>。</p><p>如果不使用<code>%</code>，则我们需要分别为<code>tools.verify.swagger</code>和<code>tools.verify.mockgen</code>定义规则，很麻烦，后面修改也困难。</p><p>另外，这里也能看出<code>tools.verify.%</code>这种命名方式的好处：tools 说明依赖的定义位于<code>scripts/make-rules/tools.mk</code> Makefile 中；verify说明<code>tools.verify.%</code>伪目标属于 verify 分类，主要用来验证工具是否安装。通过这种命名方式，你可以很容易地知道目标位于哪个 Makefile 文件中，以及想要完成的功能。</p><p>另外，上面的定义中还用到了自动变量<code>$*</code>，用来指代被匹配的值<code>swagger</code>、<code>mockgen</code>。</p><h3 id="技巧-2-善用函数" tabindex="-1"><a class="header-anchor" href="#技巧-2-善用函数" aria-hidden="true">#</a> 技巧 2：善用函数</h3><p>Makefile 自带的函数能够帮助我们实现很多强大的功能。所以，在我们编写 Makefile 的过程中，如果有功能需求，可以优先使用这些函数。我把常用的函数以及它们实现的功能整理在了 <a href="https://github.com/marmotedu/geekbang-go/blob/master/makefile/Makefile%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E5%88%97%E8%A1%A8.md" target="_blank" rel="noopener noreferrer">Makefile<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 常用函数列表 中，你可以参考下。</p><p>IAM 的 Makefile 文件中大量使用了上述函数，如果你想查看这些函数的具体使用方法和场景，可以参考 IAM 项目的 Makefile 文件 <code>make-rules</code>。</p><h3 id="技巧-3-依赖需要用到的工具" tabindex="-1"><a class="header-anchor" href="#技巧-3-依赖需要用到的工具" aria-hidden="true">#</a> 技巧 3：依赖需要用到的工具</h3><p>如果 Makefile 某个目标的命令中用到了某个工具，可以将该工具放在目标的依赖中。这样，当执行该目标时，就可以指定检查系统是否安装该工具，如果没有安装则自动安装，从而实现更高程度的自动化。例如，<code>/Makefile</code> 文件中，<code>format</code> 伪目标，定义如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>.PHONY: <span class="token function">format</span>
format: tools.verify.golines tools.verify.goimports
  @echo <span class="token string">&quot;===========&gt; Formating codes&quot;</span>
  @<span class="token variable"><span class="token variable">$(</span>FIND<span class="token variable">)</span></span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">&#39;*.go&#39;</span> <span class="token operator">|</span> <span class="token variable"><span class="token variable">$(</span>XARGS<span class="token variable">)</span></span> gofmt <span class="token parameter variable">-s</span> <span class="token parameter variable">-w</span>
  @<span class="token variable"><span class="token variable">$(</span>FIND<span class="token variable">)</span></span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">&#39;*.go&#39;</span> <span class="token operator">|</span> <span class="token variable"><span class="token variable">$(</span>XARGS<span class="token variable">)</span></span> goimports <span class="token parameter variable">-w</span> <span class="token parameter variable">-local</span> <span class="token variable"><span class="token variable">$(</span>ROOT_PACKAGE<span class="token variable">)</span></span>
  @<span class="token variable"><span class="token variable">$(</span>FIND<span class="token variable">)</span></span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">&#39;*.go&#39;</span> <span class="token operator">|</span> <span class="token variable"><span class="token variable">$(</span>XARGS<span class="token variable">)</span></span> golines <span class="token parameter variable">-w</span> --max-len<span class="token operator">=</span><span class="token number">120</span> --reformat-tags --shorten-comments --ignore-generated <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你可以看到，format 依赖<code>tools.verify.golines tools.verify.goimports</code>。我们再来看下<code>tools.verify.golines</code>的定义：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>tools.verify.%:
  @if <span class="token operator">!</span> <span class="token function">which</span> <span class="token variable">$*</span> <span class="token operator">&amp;&gt;</span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token variable"><span class="token variable">$(</span>MAKE<span class="token variable">)</span></span> tools.install.<span class="token variable">$*</span><span class="token punctuation">;</span> <span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>再来看下<code>tools.install.$*</code>规则：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>.PHONY: install.golines
install.golines:
  @<span class="token variable"><span class="token variable">$(</span>GO<span class="token variable">)</span></span> get <span class="token parameter variable">-u</span> github.com/segmentio/golines
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过<code>tools.verify.%</code>规则定义，我们可以知道，<code>tools.verify.%</code>会先检查工具是否安装，如果没有安装，就会执行<code>tools.install.$*</code>来安装。如此一来，当我们执行<code>tools.verify.%</code>目标时，如果系统没有安装 golines 命令，就会自动调用go get安装，提高了 Makefile 的自动化程度。</p><h3 id="技巧-4-把常用功能放在-makefile-中-不常用的放在分类-makefile-中" tabindex="-1"><a class="header-anchor" href="#技巧-4-把常用功能放在-makefile-中-不常用的放在分类-makefile-中" aria-hidden="true">#</a> 技巧 4：把常用功能放在 /Makefile 中，不常用的放在分类 Makefile 中</h3><p>一个项目，尤其是大型项目，有很多需要管理的地方，其中大部分都可以通过 Makefile 实现自动化操作。不过，为了保持 <code>/Makefile</code> 文件的整洁性，我们不能把所有的命令都添加在 <code>/Makefile</code> 文件中。</p><p>一个比较好的建议是，将常用功能放在 /Makefile 中，不常用的放在分类 Makefile 中，并在 /Makefile 中 include 这些分类 Makefile。</p><p>例如，IAM 项目的 /Makefile 集成了format、lint、test、build等常用命令，而将<code>gen.errcode.code、gen.errcode.doc</code>这类不常用的功能放在 <code>scripts/make-rules/gen.mk</code> 文件中。当然，我们也可以直接执行 make gen.errcode.code来执行gen.errcode.code伪目标。通过这种方式，既可以保证 /Makefile 的简洁、易维护，又可以通过make命令来运行伪目标，更加灵活。</p><h3 id="技巧-5-编写可扩展的-makefile" tabindex="-1"><a class="header-anchor" href="#技巧-5-编写可扩展的-makefile" aria-hidden="true">#</a> 技巧 5：编写可扩展的 Makefile</h3><p>什么叫可扩展的 Makefile 呢？在我看来，可扩展的 Makefile 包含两层含义：</p><ul><li>可以在不改变 Makefile 结构的情况下添加新功能。</li><li>扩展项目时，新功能可以自动纳入到 Makefile 现有逻辑中。</li></ul><p>其中的第一点，我们可以通过设计合理的 Makefile 结构来实现。要实现第二点，就需要我们在编写 Makefile 时采用一定的技巧，例如多用通配符、自动变量、函数等。这里我们来看一个例子，可以让你更好地理解。</p><p>在我们 IAM 实战项目的golang.mk中，执行 <code>make go.build</code> 时能够构建 <code>cmd/</code> 目录下的所有组件，也就是说，当有新组件添加时， <code>make go.build</code> 仍然能够构建新增的组件，这就实现了上面说的第二点。</p><p>具体实现方法如下：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>
COMMANDS <span class="token operator">?=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">filter-out</span> %.md, <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> <span class="token variable">$</span><span class="token punctuation">{</span>ROOT_DIR<span class="token punctuation">}</span>/cmd/*<span class="token punctuation">)</span><span class="token punctuation">)</span>
BINS <span class="token operator">?=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">foreach</span> cmd,<span class="token variable">$</span><span class="token punctuation">{</span>COMMANDS<span class="token punctuation">}</span>,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">notdir</span> <span class="token variable">$</span><span class="token punctuation">{</span>cmd<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> go.build
<span class="token target symbol">go.build</span><span class="token punctuation">:</span> go.build.verify <span class="token variable">$</span><span class="token punctuation">(</span>addprefix go.build., <span class="token variable">$</span><span class="token punctuation">(</span>addprefix <span class="token variable">$</span><span class="token punctuation">(</span>PLATFORM<span class="token punctuation">)</span>., <span class="token variable">$</span><span class="token punctuation">(</span>BINS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> go.build.%               

<span class="token target symbol">go.build.%</span><span class="token punctuation">:</span>             
  <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">eval</span> COMMAND <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 2,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> ., ,<span class="token variable">$*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">eval</span> PLATFORM <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 1,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> ., ,<span class="token variable">$*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">eval</span> OS <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 1,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> _, ,<span class="token variable">$</span><span class="token punctuation">(</span>PLATFORM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>           
  <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">eval</span> ARCH <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 2,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> _, ,<span class="token variable">$</span><span class="token punctuation">(</span>PLATFORM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                         
  <span class="token operator">@</span>echo <span class="token string">&quot;===========&gt; Building binary $(COMMAND) $(VERSION) for $(OS) $(ARCH)&quot;</span>
  <span class="token operator">@</span>mkdir -p <span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/platforms/<span class="token variable">$</span><span class="token punctuation">(</span>OS<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span>ARCH<span class="token punctuation">)</span>
  <span class="token operator">@</span>CGO_ENABLED<span class="token operator">=</span>0 GOOS<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>OS<span class="token punctuation">)</span> GOARCH<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>ARCH<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>GO<span class="token punctuation">)</span> build <span class="token variable">$</span><span class="token punctuation">(</span>GO_BUILD_FLAGS<span class="token punctuation">)</span> -o <span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/platforms/<span class="token variable">$</span><span class="token punctuation">(</span>OS<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span>ARCH<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span><span class="token variable">$</span><span class="token punctuation">(</span>GO_OUT_EXT<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>ROOT_PACKAGE<span class="token punctuation">)</span>/cmd/<span class="token variable">$</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span>
COMMANDS <span class="token operator">?=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">filter-out</span> %.md, <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> <span class="token variable">$</span><span class="token punctuation">{</span>ROOT_DIR<span class="token punctuation">}</span>/cmd/*<span class="token punctuation">)</span><span class="token punctuation">)</span>
BINS <span class="token operator">?=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">foreach</span> cmd,<span class="token variable">$</span><span class="token punctuation">{</span>COMMANDS<span class="token punctuation">}</span>,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">notdir</span> <span class="token variable">$</span><span class="token punctuation">{</span>cmd<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> go.build
<span class="token target symbol">go.build</span><span class="token punctuation">:</span> go.build.verify <span class="token variable">$</span><span class="token punctuation">(</span>addprefix go.build., <span class="token variable">$</span><span class="token punctuation">(</span>addprefix <span class="token variable">$</span><span class="token punctuation">(</span>PLATFORM<span class="token punctuation">)</span>., <span class="token variable">$</span><span class="token punctuation">(</span>BINS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> go.build.%               

<span class="token target symbol">go.build.%</span><span class="token punctuation">:</span>             
  <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">eval</span> COMMAND <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 2,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> ., ,<span class="token variable">$*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">eval</span> PLATFORM <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 1,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> ., ,<span class="token variable">$*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">eval</span> OS <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 1,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> _, ,<span class="token variable">$</span><span class="token punctuation">(</span>PLATFORM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>           
  <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">eval</span> ARCH <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">word</span> 2,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> _, ,<span class="token variable">$</span><span class="token punctuation">(</span>PLATFORM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                         
  <span class="token operator">@</span>echo <span class="token string">&quot;===========&gt; Building binary $(COMMAND) $(VERSION) for $(OS) $(ARCH)&quot;</span>
  <span class="token operator">@</span>mkdir -p <span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/platforms/<span class="token variable">$</span><span class="token punctuation">(</span>OS<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span>ARCH<span class="token punctuation">)</span>
  <span class="token operator">@</span>CGO_ENABLED<span class="token operator">=</span>0 GOOS<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>OS<span class="token punctuation">)</span> GOARCH<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>ARCH<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>GO<span class="token punctuation">)</span> build <span class="token variable">$</span><span class="token punctuation">(</span>GO_BUILD_FLAGS<span class="token punctuation">)</span> -o <span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/platforms/<span class="token variable">$</span><span class="token punctuation">(</span>OS<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span>ARCH<span class="token punctuation">)</span>/<span class="token variable">$</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span><span class="token variable">$</span><span class="token punctuation">(</span>GO_OUT_EXT<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>ROOT_PACKAGE<span class="token punctuation">)</span>/cmd/<span class="token variable">$</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当执行make go.build 时，会执行 go.build 的依赖 <code>$(addprefix go.build., $(addprefix $(PLATFORM)., $(BINS))</code>) ,<code>addprefix</code>函数最终返回字符串 <code>go.build.linux_amd64.iamctl go.build.linux_amd64.iam-authz-server go.build.linux_amd64.iam-apiserver ...</code> ，这时候就会执行 <code>go.build.%</code> 伪目标。</p><p>在 <code>go.build.%</code> 伪目标中，通过 eval、word、subst 函数组合，算出了 COMMAND 的值 <code>iamctl/iam-apiserver/iam-authz-server/...</code>，最终通过 <code>$(ROOT_PACKAGE)/cmd/$(COMMAND)</code> 定位到需要构建的组件的 main 函数所在目录。</p><p>上述实现中有两个技巧，你可以注意下。首先，通过</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>COMMANDS ?<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>filter-out %.md, <span class="token punctuation">$(</span>wildcard $<span class="token punctuation">{</span>ROOT_DIR<span class="token punctuation">}</span>/cmd/*<span class="token punctuation">)</span><span class="token variable">)</span></span>
BINS ?<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>foreach cmd,$<span class="token punctuation">{</span>COMMANDS<span class="token punctuation">}</span>,<span class="token punctuation">$(</span>notdir $<span class="token punctuation">{</span>cmd<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token variable">)</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>获取到了 cmd/ 目录下的所有组件名。</p><p>接着，通过使用通配符和自动变量，自动匹配到<code>go.build.linux_amd64.iam-authz-server</code> 这类伪目标并构建。</p><p>可以看到，想要编写一个可扩展的 Makefile，熟练掌握 Makefile 的用法是基础，更多的是需要我们动脑思考如何去编写 Makefile。</p><h3 id="技巧-6-将所有输出存放在一个目录下-方便清理和查找" tabindex="-1"><a class="header-anchor" href="#技巧-6-将所有输出存放在一个目录下-方便清理和查找" aria-hidden="true">#</a> 技巧 6：将所有输出存放在一个目录下，方便清理和查找</h3><p>在执行 Makefile 的过程中，会输出各种各样的文件，例如 Go 编译后的二进制文件、测试覆盖率数据等，我建议你把这些文件统一放在一个目录下，方便后期的清理和查找。通常我们可以把它们放在<code>_output</code>这类目录下，这样清理时就很方便，只需要清理<code>_output</code>文件夹就可以，例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>.PHONY: go.clean
go.clean:
  @echo <span class="token string">&quot;===========&gt; Cleaning all build output&quot;</span>
  @-rm <span class="token parameter variable">-vrf</span> <span class="token variable"><span class="token variable">$(</span>OUTPUT_DIR<span class="token variable">)</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里要注意，要用<code>-rm</code>，而不是rm，防止在没有<code>_output</code>目录时，执行<code>make go.clean</code>报错。</p><h3 id="技巧-7-使用带层级的命名方式" tabindex="-1"><a class="header-anchor" href="#技巧-7-使用带层级的命名方式" aria-hidden="true">#</a> 技巧 7：使用带层级的命名方式</h3><p>通过使用带层级的命名方式，例如<code>tools.verify.swagger</code> ，我们可以实现目标分组管理。这样做的好处有很多。首先，当 Makefile 有大量目标时，通过分组，我们可以更好地管理这些目标。其次，分组也能方便理解，可以通过组名一眼识别出该目标的功能类别。最后，这样做还可以大大减小目标重名的概率。</p><p>例如，IAM 项目的 Makefile 就大量采用了下面这种命名方式。</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> gen.run
<span class="token target symbol">gen.run</span><span class="token punctuation">:</span> gen.clean gen.errcode gen.docgo

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> gen.errcode
<span class="token target symbol">gen.errcode</span><span class="token punctuation">:</span> gen.errcode.code gen.errcode.doc

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> gen.errcode.code
<span class="token target symbol">gen.errcode.code</span><span class="token punctuation">:</span> tools.verify.codegen
    ...
<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> gen.errcode.doc
<span class="token target symbol">gen.errcode.doc</span><span class="token punctuation">:</span> tools.verify.codegen
    ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="技巧-8-做好目标拆分" tabindex="-1"><a class="header-anchor" href="#技巧-8-做好目标拆分" aria-hidden="true">#</a> 技巧 8：做好目标拆分</h3><p>还有一个比较实用的技巧：我们要合理地拆分目标。比如，我们可以将安装工具拆分成两个目标：验证工具是否已安装和安装工具。通过这种方式，可以给我们的 Makefile 带来更大的灵活性。例如：我们可以根据需要选择性地执行其中一个操作，也可以两个操作一起执行。</p><p>这里来看一个例子：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token target symbol">gen.errcode.code</span><span class="token punctuation">:</span> tools.verify.codegen

<span class="token target symbol">tools.verify.%</span><span class="token punctuation">:</span>    
  <span class="token operator">@</span>if ! which <span class="token variable">$*</span> &amp;&gt;/dev/null<span class="token punctuation">;</span> then <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> tools.install.<span class="token variable">$*;</span> fi  

<span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> install.codegen
<span class="token target symbol">install.codegen</span><span class="token punctuation">:</span>              
  <span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>GO<span class="token punctuation">)</span> install <span class="token variable">$</span><span class="token punctuation">{</span>ROOT_DIR<span class="token punctuation">}</span>/tools/codegen/codegen.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的 Makefile 中，<code>gen.errcode.code</code> 依赖了 <code>tools.verify.codegen</code>，<code>tools.verify.codegen</code> 会先检查 codegen 命令是否存在，如果不存在，再调用 install.codegen 来安装 codegen 工具。</p><p>如果我们的 Makefile 设计是：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>gen.errcode.code: install.codegen
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>那每次执行 gen.errcode.code 都要重新安装 codegen 命令，这种操作是不必要的，还会导致 make gen.errcode.code 执行很慢。</p><h3 id="技巧-9-设置-options" tabindex="-1"><a class="header-anchor" href="#技巧-9-设置-options" aria-hidden="true">#</a> 技巧 9：设置 OPTIONS</h3><p>编写 Makefile 时，我们还需要把一些可变的功能通过 OPTIONS 来控制。为了帮助你理解，这里还是拿 IAM 项目的 Makefile 来举例。</p><p>假设我们需要通过一个选项 V ，来控制是否需要在执行 Makefile 时打印详细的信息。这可以通过下面的步骤来实现。</p><p>首先，在 <code>/Makefile</code> 中定义 <code>USAGE_OPTIONS</code> 。定义 <code>USAGE_OPTIONS</code> 可以使开发者在执行 make help 后感知到此 OPTION，并根据需要进行设置。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>define USAGE_OPTIONS    
                         
Options:
  <span class="token punctuation">..</span>.
  BINS         The binaries to build. Default is all of cmd.
               <span class="token punctuation">..</span>.
  <span class="token punctuation">..</span>.
  V            Set to <span class="token number">1</span> <span class="token builtin class-name">enable</span> verbose build. Default is <span class="token number">0</span>.    
endef    
<span class="token builtin class-name">export</span> USAGE_OPTIONS    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着，在<code>scripts/make-rules/common.mk</code>文件中，我们通过判断有没有设置 V 选项，来选择不同的行为：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token keyword">ifndef</span> V    
MAKEFLAGS <span class="token operator">+=</span> --no-print-directory    
<span class="token keyword">endif</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然，我们还可以通过下面的方法来使用 V ：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ifeq <span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>origin V<span class="token variable">)</span></span>, undefined<span class="token punctuation">)</span>                               

MAKEFLAGS <span class="token operator">+=</span> --no-print-directory              
endif
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面，我介绍了 <code>VOPTION</code>，我们在 <code>Makefile</code> 中通过判断有没有定义 <code>V</code> ，来执行不同的操作。其实还有一种 <code>OPTION</code>，这种 <code>OPTION</code> 的值我们在 Makefile 中是直接使用的，例如 <code>BINS</code>。针对这种 <code>OPTION</code>，我们可以通过以下方式来使用：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>BINS ?<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>foreach cmd,$<span class="token punctuation">{</span>COMMANDS<span class="token punctuation">}</span>,<span class="token punctuation">$(</span>notdir $<span class="token punctuation">{</span>cmd<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token variable">)</span></span>
<span class="token punctuation">..</span>.
go.build: go.build.verify <span class="token variable"><span class="token variable">$(</span>addprefix go.build., <span class="token punctuation">$(</span>addprefix <span class="token punctuation">$(</span>PLATFORM<span class="token punctuation">)</span>., <span class="token punctuation">$(</span>BINS<span class="token punctuation">)</span><span class="token variable">)</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也就是说，通过 <code>?=</code> 来判断 BINS 变量有没有被赋值，如果没有，则赋予等号后的值。接下来，就可以在 Makefile 规则中使用它。</p><h3 id="技巧-10-定义环境变量" tabindex="-1"><a class="header-anchor" href="#技巧-10-定义环境变量" aria-hidden="true">#</a> 技巧 10：定义环境变量</h3><p>我们可以在 Makefile 中定义一些环境变量，例如：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>GO <span class="token operator">:=</span> go                                          
GO_SUPPORTED_VERSIONS <span class="token operator">?=</span> 1.13<span class="token operator">|</span>1.14<span class="token operator">|</span>1.15<span class="token operator">|</span>1.16<span class="token operator">|</span>1.17    
GO_LDFLAGS <span class="token operator">+=</span> -X <span class="token variable">$</span><span class="token punctuation">(</span>VERSION_PACKAGE<span class="token punctuation">)</span>.GitVersion<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>VERSION<span class="token punctuation">)</span> \    
  -X <span class="token variable">$</span><span class="token punctuation">(</span>VERSION_PACKAGE<span class="token punctuation">)</span>.GitCommit<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>GIT_COMMIT<span class="token punctuation">)</span> \       
  -X <span class="token variable">$</span><span class="token punctuation">(</span>VERSION_PACKAGE<span class="token punctuation">)</span>.GitTreeState<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>GIT_TREE_STATE<span class="token punctuation">)</span> \                          
  -X <span class="token variable">$</span><span class="token punctuation">(</span>VERSION_PACKAGE<span class="token punctuation">)</span>.BuildDate<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">shell</span> date -u +<span class="token string">&#39;%Y-%m-%dT%H:%M:%SZ&#39;</span><span class="token punctuation">)</span>    
<span class="token keyword">ifneq</span> <span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span>DLV<span class="token punctuation">)</span>,<span class="token punctuation">)</span>                                                                                                                              
  GO_BUILD_FLAGS <span class="token operator">+=</span> -gcflags <span class="token string">&quot;all=-N -l&quot;</span>    
  LDFLAGS <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>      
<span class="token keyword">endif</span>                                                                                   
GO_BUILD_FLAGS <span class="token operator">+=</span> -tags<span class="token operator">=</span>jsoniter -ldflags <span class="token string">&quot;$(GO_LDFLAGS)&quot;</span> 
...
FIND <span class="token operator">:=</span> find . ! -path <span class="token string">&#39;./third_party/*&#39;</span> ! -path <span class="token string">&#39;./vendor/*&#39;</span>    
XARGS <span class="token operator">:=</span> xargs --no-run-if-empty 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些环境变量和编程中使用宏定义的作用是一样的：只要修改一处，就可以使很多地方同时生效，避免了重复的工作。</p><p>通常，我们可以将 GO、GO_BUILD_FLAGS、FIND 这类变量定义为环境变量。</p><h3 id="技巧-11-自己调用自己" tabindex="-1"><a class="header-anchor" href="#技巧-11-自己调用自己" aria-hidden="true">#</a> 技巧 11：自己调用自己</h3><p>在编写 Makefile 的过程中，你可能会遇到这样一种情况：A-Target 目标命令中，需要完成操作 B-Action，而操作 B-Action 我们已经通过伪目标 B-Target 实现过。为了达到最大的代码复用度，这时候最好的方式是在 A-Target 的命令中执行 B-Target。方法如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>tools.verify.%:
  @if <span class="token operator">!</span> <span class="token function">which</span> <span class="token variable">$*</span> <span class="token operator">&amp;&gt;</span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token variable"><span class="token variable">$(</span>MAKE<span class="token variable">)</span></span> tools.install.<span class="token variable">$*</span><span class="token punctuation">;</span> <span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这里，我们通过 <code>$(MAKE)</code> 调用了伪目标 <code>tools.install.$*</code> 。要注意的是，默认情况下，Makefile 在切换目录时会输出以下信息：</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>$ make tools.install.codegen
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span>&gt; Installing codegen
<span class="token target symbol">make[1]</span><span class="token punctuation">:</span> Entering directory `/home/colin/workspace/golang/src/github.com/marmotedu/iam&#39;
<span class="token target symbol">make[1]</span><span class="token punctuation">:</span> Leaving directory `/home/colin/workspace/golang/src/github.com/marmotedu/iam&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果觉得 Entering directory 这类信息很烦人，可以通过设置 <code>MAKEFLAGS += --no-print-directory</code> 来禁止 Makefile 打印这些信息。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p><strong>规范的 Makefile 文件需要的步骤：</strong></p><ol><li>v首先，你需要熟练掌握 Makefile 的语法。我建议你重点掌握以下语法：Makefile 规则语法、伪目标、变量赋值、特殊变量、自动化变量。</li><li>接着，我们需要提前规划 Makefile 要实现的功能。一个大型 Go 项目通常需要实现以下功能：代码生成类命令、格式化类命令、静态代码检查、 测试类命令、构建类命令、Docker 镜像打包类命令、部署类命令、清理类命令，等等。</li><li>然后，我们还需要通过 Makefile 功能分类、文件分层、复杂命令脚本化等方式，来设计一个合理的 Makefile 结构。</li><li>最后，我们还需要掌握一些 Makefile 编写技巧，例如：善用通配符、自动变量和函数；编写可扩展的 Makefile；使用带层级的命名方式，等等。通过这些技巧，可以进一步保证我们编写出一个高质量的 Makefile。</li></ol><h2 id="end-链接" tabindex="-1"><a class="header-anchor" href="#end-链接" aria-hidden="true">#</a> END 链接</h2><ul><li><div><a href="6.md" style="float:left;">⬆️上一节🔗 </a><a href="8.md" style="float:right;"> ️下一节🔗</a></div></li></ul><ul><li><p><a href="/projects/" class="">Ⓜ️回到目录🏠</a></p></li><li><p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>🫵参与贡献💞❤️‍🔥💖</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p></li><li><p>✴️版权声明 © ：本书所有内容遵循<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0协议（署名-相同方式共享）©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><h3 id="links" tabindex="-1"><a class="header-anchor" href="#links" aria-hidden="true">#</a> LInks</h3><ul><li>https://time.geekbang.org/column/article/389115</li><li>https://github.com/cubxxw/iam/blob/master/Makefile</li><li>https://seisman.github.io/how-to-write-makefile/rules.html</li><li>https://colynn.github.io/2020-03-03-using_makefile/</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/3293172751/awesome-go/edit/master/docs/projects/projects/7.md" rel="noopener noreferrer" target="_blank" aria-label="在GitHub上贡献此页面"><!--[--><!--]--> 在GitHub上贡献此页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 3293172751nss@gmail.com">Xinwei Xiong</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 3293172751nss@gmail.com">xiongxinwei</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.bdc458db.js" defer></script>
  </body>
</html>
