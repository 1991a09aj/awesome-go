import{_ as c,r as p,o as i,c as l,a as n,b as a,w as o,e as s,d as u}from"./app.64dac66d.js";const r={},d={href:"https://github.com/3293172751",target:"_blank",rel:"noopener noreferrer"},k=s("author"),v=n("h1",{id:"\u7B2C8\u8282-\u5199\u5165\u6A21\u5757\u7684\u5B9E\u73B0",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7B2C8\u8282-\u5199\u5165\u6A21\u5757\u7684\u5B9E\u73B0","aria-hidden":"true"},"#"),s(" \u7B2C8\u8282 \u5199\u5165\u6A21\u5757\u7684\u5B9E\u73B0")],-1),m=s("\u56DE\u5230\u76EE\u5F55"),b=s("\u4E0A\u4E00\u8282"),h=s("\u2764\uFE0F\u{1F495}\u{1F495}Go\u8BED\u8A00\u9AD8\u7EA7\u7BC7\u7AE0,\u5728\u6B64\u4E4B\u524D\u5EFA\u8BAE\u60A8\u5148\u4E86\u89E3\u57FA\u7840\u548C\u8FDB\u9636\u7BC7\u3002Myblog:"),_={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},g=s("http://nsddd.top"),f={id:"go\u8BED\u8A00\u57FA\u7840\u7BC7",tabindex:"-1"},w=n("a",{class:"header-anchor",href:"#go\u8BED\u8A00\u57FA\u7840\u7BC7","aria-hidden":"true"},"#",-1),x=s(),q={href:"https://github.com/3293172751/Block_Chain/blob/master/TOC.md",target:"_blank",rel:"noopener noreferrer"},T=s("Go\u8BED\u8A00\u57FA\u7840\u7BC7"),y={id:"go\u8BED\u8A00100\u7BC7\u8FDB\u9636",tabindex:"-1"},S=n("a",{class:"header-anchor",href:"#go\u8BED\u8A00100\u7BC7\u8FDB\u9636","aria-hidden":"true"},"#",-1),C=s(),P={href:"https://github.com/3293172751/Block_Chain/blob/master/Gomd_super/README.md",target:"_blank",rel:"noopener noreferrer"},B=s("Go\u8BED\u8A00100\u7BC7\u8FDB\u9636"),N=u(`<hr><p>[TOC]</p><h3 id="\u5199\u5165\u6A21\u5757\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#\u5199\u5165\u6A21\u5757\u7684\u5B9E\u73B0" aria-hidden="true">#</a> \u5199\u5165\u6A21\u5757\u7684\u5B9E\u73B0</h3><ol><li>\u521D\u59CB\u5316Influxdb cllient</li><li>\u4ECEwrite channel\u4E2D\u8BFB\u53D6\u5230\u76D1\u63A7\u6570\u636E</li><li>\u6784\u9020\u6570\u636E\u5E76\u4E14\u5199\u5165\u5230influxdb</li></ol><p><strong>pull\u5305</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>go get github.com/influxdata/influxdb1-client/v2  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u5BFC\u5165\u5305</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>import &quot;github.com/influxdata/influxdb1-client/v2&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u5199\u5165\u6A21\u5757\u7A0B\u5E8F" tabindex="-1"><a class="header-anchor" href="#\u5199\u5165\u6A21\u5757\u7A0B\u5E8F" aria-hidden="true">#</a> \u5199\u5165\u6A21\u5757\u7A0B\u5E8F</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>w <span class="token operator">*</span>WriteToInfluxDB<span class="token punctuation">)</span> <span class="token function">Writer</span><span class="token punctuation">(</span>wc <span class="token keyword">chan</span> <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//\u5199\u5165\u6A21\u5757</span>
	infSli <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>influxDBsn<span class="token punctuation">,</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span> <span class="token comment">//\u4F7F\u7528@\u505A\u5207\u5272</span>

	<span class="token comment">// Create a new HTTPClient</span>
	c<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewHTTPClient</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>HTTPConfig<span class="token punctuation">{</span>
		Addr<span class="token punctuation">:</span>     infSli<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//\u5730\u5740</span>
		Username<span class="token punctuation">:</span> infSli<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//\u7528\u6237\u540D</span>
		Password<span class="token punctuation">:</span> infSli<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//\u5BC6\u7801</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// Create a new point batch</span>
	bp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewBatchPoints</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>BatchPointsConfig<span class="token punctuation">{</span>
		Database<span class="token punctuation">:</span>  infSli<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		Precision<span class="token punctuation">:</span> infSli<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> wc <span class="token punctuation">{</span>
		<span class="token comment">// \u5FAA\u73AF\u7684\u5199\u5165\u6570\u636E</span>
		<span class="token comment">/*
			+ Tags\uFF1APath, Method, Scheme, Status
			+ Fields\uFF1AUpstreamTime, RequestTime\uFF0CBytesSent
			+ Time\uFF1ATimeLocal
		*/</span>
		tags <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Path&quot;</span><span class="token punctuation">:</span> v<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">&quot;Method&quot;</span><span class="token punctuation">:</span> v<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> <span class="token string">&quot;Scheme&quot;</span><span class="token punctuation">:</span> v<span class="token punctuation">.</span>Scheme<span class="token punctuation">,</span> <span class="token string">&quot;Status&quot;</span><span class="token punctuation">:</span> v<span class="token punctuation">.</span>Status<span class="token punctuation">}</span>
		fields <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
			<span class="token string">&quot;UpstreamTime&quot;</span><span class="token punctuation">:</span> v<span class="token punctuation">.</span>UpstreamTime<span class="token punctuation">,</span>
			<span class="token string">&quot;RequestTime&quot;</span><span class="token punctuation">:</span>  v<span class="token punctuation">.</span>RequestTime<span class="token punctuation">,</span>
			<span class="token string">&quot;BytesSent&quot;</span><span class="token punctuation">:</span>    v<span class="token punctuation">.</span>BytesSent<span class="token punctuation">,</span>
		<span class="token punctuation">}</span>

		pt<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewPoint</span><span class="token punctuation">(</span><span class="token string">&quot;nginx_log&quot;</span><span class="token punctuation">,</span> tags<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//\u521B\u5EFAInfluxdb\u5B57\u6BB5</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;client.NewPoint err = &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		bp<span class="token punctuation">.</span><span class="token function">AddPoint</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span>

		<span class="token comment">// Write the batch</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bp<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Close client resources</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;write success&quot;</span><span class="token punctuation">)</span> <span class="token comment">//\u5982\u679C\u5199\u5165\u6210\u529F\u5C31\u6253\u5370\u65E5\u5FD7</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="end-\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#end-\u94FE\u63A5" aria-hidden="true">#</a> END \u94FE\u63A5</h2>`,11),E=s("\u56DE\u5230\u76EE\u5F55"),F=s("\u4E0A\u4E00\u8282"),M=s("\u4E0B\u4E00\u8282"),R=n("hr",null,null,-1),D={href:"https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md",target:"_blank",rel:"noopener noreferrer"},G=s("\u53C2\u4E0E\u8D21\u732E\u2764\uFE0F\u{1F495}\u{1F495}");function I(L,U){const t=p("ExternalLinkIcon"),e=p("RouterLink");return i(),l("div",null,[n("ul",null,[n("li",null,[n("a",d,[k,a(t)])])]),v,n("ul",null,[n("li",null,[a(e,{to:"/go-advancend/"},{default:o(()=>[m]),_:1})]),n("li",null,[a(e,{to:"/go-advancend/markdown/7.html"},{default:o(()=>[b]),_:1})])]),n("blockquote",null,[n("p",null,[h,n("a",_,[g,a(t)])]),n("h3",f,[w,x,n("strong",null,[n("a",q,[T,a(t)])])]),n("h3",y,[S,C,n("strong",null,[n("a",P,[B,a(t)])])])]),N,n("ul",null,[n("li",null,[a(e,{to:"/go-advancend/"},{default:o(()=>[E]),_:1})]),n("li",null,[a(e,{to:"/go-advancend/markdown/7.html"},{default:o(()=>[F]),_:1})]),n("li",null,[a(e,{to:"/go-advancend/markdown/9.html"},{default:o(()=>[M]),_:1})])]),R,n("ul",null,[n("li",null,[n("a",D,[G,a(t)])])])])}const W=c(r,[["render",I],["__file","8.html.vue"]]);export{W as default};
